commonfields:
  id: AWS - Lambda
  version: -1
name: AWS - Lambda
display: AWS - Lambda
category: IT Services
image: data:image/png;base64,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
description: Amazon Web Services Serverless Compute service (lambda)
configuration:
- display: Default Region
  name: defaultRegion
  defaultvalue: ""
  type: 0
  required: true
- display: Role Arn
  name: roleArn
  defaultvalue: ""
  type: 0
  required: false
- display: Role Session Name
  name: roleSessionName
  defaultvalue: ""
  type: 0
  required: false
- display: Role Session Duration
  name: sessionDuration
  defaultvalue: ""
  type: 0
  required: false
script:
  script: |-
    """IMPORTS"""
    import boto3
    import datetime
    import base64


    """GLOBAL VARIABLES"""
    AWS_DEFAULT_REGION = demisto.params()['defaultRegion']
    AWS_roleArn = demisto.params()['roleArn']
    AWS_roleSessionName = demisto.params()['roleSessionName']
    AWS_roleSessionDuration = demisto.params()['sessionDuration']
    AWS_rolePolicy = None


    """HELPER FUNCTIONS"""
    def aws_session(service='lambda',region=None,roleArn=None,roleSessionName=None,roleSessionDuration=None,rolePolicy=None):
      kwargs = {}
      if roleArn and roleSessionName is not None:
        kwargs.update({
        'RoleArn':roleArn,
        'RoleSessionName':roleSessionName,
        })
      elif AWS_roleArn and AWS_roleSessionName is not None:
        kwargs.update({
        'RoleArn':AWS_roleArn,
        'RoleSessionName':AWS_roleSessionName,
        })
      if roleSessionDuration is not None:
        kwargs.update({'DurationSeconds':int(roleSessionDuration)})
      elif AWS_roleSessionDuration is not None:
        kwargs.update({'DurationSeconds':int(AWS_roleSessionDuration)})
      if rolePolicy is not None:
        kwargs.update({'Policy':rolePolicy})
      elif AWS_rolePolicy is not None:
        kwargs.update({'Policy':AWS_rolePolicy})
      if kwargs:
        sts_client = boto3.client('sts')
        sts_response = sts_client.assume_role(**kwargs)
        if region is not None:
          client = boto3.client(
          service_name=service,
          region_name=region,
          aws_access_key_id=sts_response['Credentials']['AccessKeyId'],
          aws_secret_access_key=sts_response['Credentials']['SecretAccessKey'],
          aws_session_token=sts_response['Credentials']['SessionToken']
          )
        else:
          client = boto3.client(
          service_name=service,
          region_name=AWS_DEFAULT_REGION,
          aws_access_key_id=sts_response['Credentials']['AccessKeyId'],
          aws_secret_access_key=sts_response['Credentials']['SecretAccessKey'],
          aws_session_token=sts_response['Credentials']['SessionToken']
          )
      else:
        if region is not None:
          client = boto3.client(service_name=service,region_name=region)
        else:
          client = boto3.client(service_name=service,region_name=AWS_DEFAULT_REGION)
      return client

    def parse_tag_field(tags_str):
      tags = []
      regex = re.compile(r'key=([\w\d_:.-]+),value=([ /\w\d@_,.\*-]+)', flags=re.I)
      for f in tags_str.split(';'):
        match = regex.match(f)
        if match is None:
          demisto.log('could not parse field: %s' % (f, ))
          continue

        tags.append({
        'Key': match.group(1),
        'Value': match.group(2)
        })
      return tags


    class DatetimeEncoder(json.JSONEncoder):
      def default(self, obj):
        if isinstance (obj, datetime.datetime):
          return obj.strftime ('%Y-%m-%dT%H:%M:%S')
        elif isinstance (obj, datetime.date):
          return obj.strftime ('%Y-%m-%d')
        elif isinstance(obj, datetime):
          return obj.strftime('%Y-%m-%dT%H:%M:%S')
        elif isinstance(obj, date):
          return obj.strftime('%Y-%m-%d')
        # Let the base class default method raise the TypeError
        return json.JSONEncoder.default(self, obj)


    def parse_resource_ids(resource_id):
      id_list = resource_id.replace(" ", "")
      resource_ids = id_list.split(",")
      return resource_ids


    def create_entry(title,data, ec):
      return {
      'ContentsFormat': formats['json'],
      'Type': entryTypes['note'],
      'Contents': data,
      'ReadableContentsFormat': formats['markdown'],
      'HumanReadable': tableToMarkdown(title, data) if data else 'No result were found',
      'EntryContext': ec
      }


    """MAIN FUNCTIONS"""
    def add_layer_version_permission(args):
      client = aws_session(
      region = args.get('region'),
      roleArn = args.get('roleArn'),
      roleSessionName = args.get('roleSessionName'),
      roleSessionDuration = args.get('roleSessionDuration'),
      )
      obj = vars(client._client_config)
      kwargs = {
      'LayerName':args.get('LayerName'),
      'VersionNumber': int(args.get('VersionNumber')),
      'StatementId': args.get('StatementId'),
      'Action': args.get('Action'),
      'Principal': args.get('Principal')
      }
      if args.get('OrganizationId') is not None:
        kwargs.update({'OrganizationId':args.get('OrganizationId')})
      if args.get('RevisionId') is not None:
        kwargs.update({'RevisionId':args.get('RevisionId')})

      response = client.get_function(**kwargs)
      data = ({
      'Statement': response['Statement'],
      'RevisionId': response['RevisionId']
      })
      raw = json.loads(json.dumps(response, cls=DatetimeEncoder))
      ec = {'AWS.Lambda.Permission(val.RevisionId === obj.RevisionId)': raw}
      demisto.results(create_entry('AWS Lambda Add Layer Version Permission',data, ec))

    def add_permission(args):
      client = aws_session(
      region = args.get('region'),
      roleArn = args.get('roleArn'),
      roleSessionName = args.get('roleSessionName'),
      roleSessionDuration = args.get('roleSessionDuration'),
      )
      obj = vars(client._client_config)
      kwargs = {
      'FunctionName':args.get('FunctionName'),
      'StatementId': args.get('StatementId'),
      'Action': args.get('Action'),
      'Principal': args.get('Principal')
      }
      if args.get('SourceArn') is not None:
        kwargs.update({'SourceArn':args.get('SourceArn')})
      if args.get('SourceAccount') is not None:
        kwargs.update({'SourceAccount':args.get('SourceAccount')})
      if args.get('EventSourceToken') is not None:
        kwargs.update({'EventSourceToken':args.get('EventSourceToken')})
      if args.get('Qualifier') is not None:
        kwargs.update({'Qualifier':args.get('Qualifier')})
      if args.get('RevisionId') is not None:
        kwargs.update({'RevisionId':args.get('RevisionId')})

      response = client.get_function(**kwargs)
      data = ({
      'Statement': response['Statement']
      })
      raw = json.loads(json.dumps(response, cls=DatetimeEncoder))
      ec = {'AWS.Lambda.Permissions(val.FunctionArn === obj.FunctionArn)': raw}
      demisto.results(create_entry('AWS Lambda Functions',data, ec))


    def get_function(args):
      client = aws_session(
      region = args.get('region'),
      roleArn = args.get('roleArn'),
      roleSessionName = args.get('roleSessionName'),
      roleSessionDuration = args.get('roleSessionDuration'),
      )
      obj = vars(client._client_config)
      kwargs = {'FunctionName':args.get('functionName')}
      if args.get('qualifier') is not None:
        kwargs.update({'Qualifier':args.get('qualifier')})

      response = client.get_function(**kwargs)
      func = response['Configuration']
      data = ({
      'FunctionName': func['FunctionName'],
      'FunctionArn': func['FunctionArn'],
      'Runtime': func['Runtime'],
      'Region': obj['_user_provided_options']['region_name'],
      })

      raw = json.loads(json.dumps(response, cls=DatetimeEncoder))
      if raw:
        raw.update({'Region': obj['_user_provided_options']['region_name']})
      ec = {'AWS.Lambda.Functions(val.FunctionArn === obj.FunctionArn)': raw}
      demisto.results(create_entry('AWS Lambda Functions',data, ec))


    def list_functions(args):
      client = aws_session(
      region = args.get('region'),
      roleArn = args.get('roleArn'),
      roleSessionName = args.get('roleSessionName'),
      roleSessionDuration = args.get('roleSessionDuration'),
      )
      obj = vars(client._client_config)
      data = []
      output =[]

      paginator = client.get_paginator('list_functions')
      for response in paginator.paginate():
        for function in response['Functions']:
          data.append ({
          'FunctionName': function['FunctionName'],
          'FunctionArn': function['FunctionArn'],
          'Runtime': function['Runtime'],
          'LastModified': datetime.datetime.strftime(function['LastModified'], '%Y-%m-%d %H:%M:%S'),
          'Region': obj['_user_provided_options']['region_name'],
          })
          output.append(function)

      raw = json.loads(json.dumps(output, cls=DatetimeEncoder))
      if raw:
        raw.update({'Region': obj['_user_provided_options']['region_name']})
      ec = {'AWS.Lambda.Functions(val.FunctionArn === obj.FunctionArn)': raw}
      demisto.results(create_entry('AWS Lambda Functions',data, ec))


    def list_aliases(args):
      client = aws_session(
      region = args.get('region'),
      roleArn = args.get('roleArn'),
      roleSessionName = args.get('roleSessionName'),
      roleSessionDuration = args.get('roleSessionDuration'),
      )

      data = []
      output =[]
      kwargs = {'FunctionName':args.get('functionName')}
      if args.get('functionVersion') is not None:
        kwargs.update({'FunctionVersion':args.get('functionVersion')})

      paginator = client.get_paginator('list_aliases')
      for response in paginator.paginate(**kwargs):
        for alias in response['Aliases']:
          data.append ({
          'AliasArn': alias['AliasArn'],
          'Name': alias['Name'],
          'FunctionVersion': alias['FunctionVersion'],
          })
          output.append(alias)

      raw = json.loads(json.dumps(output, cls=DatetimeEncoder))
      ec = {'AWS.Lambda.Aliases(val.AliasArn === obj.AliasArn)': raw}
      demisto.results(create_entry('AWS Lambda Aliases',data, ec))


    def invoke(args):
      client = aws_session(
      region = args.get('region'),
      roleArn = args.get('roleArn'),
      roleSessionName = args.get('roleSessionName'),
      roleSessionDuration = args.get('roleSessionDuration'),
      )
      obj = vars(client._client_config)
      kwargs = {'FunctionName':args.get('functionName')}
      if args.get('invocationType') is not None:
        kwargs.update({'InvocationType':args.get('invocationType')})
      if args.get('logType') is not None:
        kwargs.update({'LogType':args.get('logType')})
      if args.get('clientContext') is not None:
        kwargs.update({'ClientContext':args.get('clientContext')})
      if args.get('payload') is not None:
        kwargs.update({'Payload':json.dumps(args.get('payload'))})
      if args.get('qualifier') is not None:
        kwargs.update({'Qualifier':args.get('qualifier')})
      response = client.invoke(**kwargs)
      data = ({
      'FunctionName': args.get('functionName'),
      'FunctionError': response['FunctionError'],
      'Region': obj['_user_provided_options']['region_name'],
      })
      if 'LogResult' in response:
        data[0].update({'LogResult': base64.b64decode(response['LogResult'])})
      if 'Payload' in response:
        data[0].update({'Payload': json.dumps(response['Payload'])})
      if 'ExecutedVersion' in response:
        data[0].update({'ExecutedVersion': response['ExecutedVersion']})
      ec = {'AWS.Lambda.InvokedFunctions': data}
      demisto.results(create_entry('AWS Lambda Invoked Functions',data, ec))


    """TEST FUNCTION"""
    def test_function():
      client = aws_session()
      response = client.list_functions()
      if response['ResponseMetadata']['HTTPStatusCode'] == 200:
        demisto.results('ok')


    """EXECUTION BLOCK"""
    try:
      if demisto.command() == 'test-module':
        test_function()
      elif demisto.command() == 'aws-lambda-add-layer-version-permission':
        add_layer_version_permission(demisto.args())
      elif demisto.command() == 'aws-lambda-add-permission':
        add_permission(demisto.args())
      elif demisto.command() == 'aws-lambda-get-function':
        get_function(demisto.args())
      elif demisto.command() == 'aws-lambda-list-functions':
        list_functions(demisto.args())
      elif demisto.command() == 'aws-lambda-list-aliases':
        list_aliases(demisto.args())
      elif demisto.command() == 'aws-lambda-invoke':
        invoke(demisto.args())
    except Exception as e:
      LOG(e)
      LOG.print_log(False)
      return_error(e.message)

  type: python
  commands:
  - name: aws-lambda-get-function
    arguments:
    - name: functionName
      required: true
      description: The name of the Lambda function.
    - name: qualifier
      description: Specify a version or alias to get details about a published version
        of the function.
    outputs:
    - contextPath: AWS.Lambda.Functions.Configuration.FunctionName
      description: The name of the function.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.FunctionArn
      description: The function's Amazon Resource Name.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Runtime
      description: The runtime environment for the Lambda function.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Role
      description: The function's execution role.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Handler
      description: The function Lambda calls to begin executing your function.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.CodeSize
      description: The size of the function's deployment package in bytes.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Description
      description: The function's description.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Timeout
      description: The amount of time that Lambda allows a function to run before
        terminating it.
      type: number
    - contextPath: AWS.Lambda.Functions.Configuration.MemorySize
      description: The memory allocated to the function
      type: number
    - contextPath: 'AWS.Lambda.Functions.Configuration.LastModified '
      description: The date and time that the function was last updated, in ISO-8601
        format (YYYY-MM-DDThh:mm:ss.sTZD).
      type: date
    - contextPath: AWS.Lambda.Functions.Configuration.CodeSha256
      description: The SHA256 hash of the function's deployment package.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Version
      description: The version of the Lambda function.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.VpcConfig.SubnetIds
      description: A list of VPC subnet IDs.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.VpcConfig.SecurityGroupIds
      description: A list of VPC security groups IDs.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.VpcConfig.VpcId
      description: The ID of the VPC.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.DeadLetterConfig.TargetArn
      description: The Amazon Resource Name (ARN) of an Amazon SQS queue or Amazon
        SNS topic.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Environment.Variables
      description: Environment variable key-value pairs
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Environment.Error.ErrorCode
      description: Error messages for environment variables that could not be applied.
        The error code.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Environment.
      description: Error messages for environment variables that could not be applied.
        The error message.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.KMSKeyArn
      description: The KMS key used to encrypt the function's environment variables.
        Only returned if you've configured a customer managed CMK.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.TracingConfig.Mode
      description: The function's AWS X-Ray tracing configuration. The tracing mode.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.MasterArn
      description: The ARN of the master function.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.RevisionId
      description: Represents the latest updated revision of the function or alias.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Layers.Arn
      description: The Amazon Resource Name (ARN) of the function layer.
      type: string
    - contextPath: AWS.Lambda.Functions.Configuration.Layers.CodeSize
      description: The size of the layer archive in bytes.
      type: number
    - contextPath: AWS.Lambda.Functions.Code.RepositoryType
      description: The repository from which you can download the function.
      type: string
    - contextPath: AWS.Lambda.Functions.Code.Location
      description: The presigned URL you can use to download the function's .zip file
        that you previously uploaded. The URL is valid for up to 10 minutes.
      type: string
    - contextPath: AWS.Lambda.Functions.Tags
      description: list of tags associated with the function.
      type: string
    - contextPath: AWS.Lambda.Functions.Concurrency.ReservedConcurrentExecutions
      description: The number of concurrent executions reserved for this function.
      type: string
    description: Returns the configuration information of the Lambda function and
      a presigned URL link to the .zip file you uploaded with CreateFunction so you
      can download the .zip file. Note that the URL is valid for up to 10 minutes.
      The configuration information is the same information you provided as parameters
      when uploading the function.  Use the Qualifier parameter to retrieve a published
      version of the function. Otherwise, returns the unpublished version ($LATEST
      ).
  - name: aws-lambda-list-functions
    arguments: []
    outputs:
    - contextPath: AWS.Lambda.Functions.FunctionName
      description: The name of the function.
      type: string
    - contextPath: AWS.Lambda.Functions.FunctionArn
      description: The function's Amazon Resource Name.
      type: string
    - contextPath: AWS.Lambda.Functions.Runtime
      description: The runtime environment for the Lambda function.
      type: string
    - contextPath: AWS.Lambda.Functions.Role
      description: The function's execution role.
      type: string
    - contextPath: AWS.Lambda.Functions.Handler
      description: The function Lambda calls to begin executing your function.
      type: string
    - contextPath: AWS.Lambda.Functions.CodeSize
      description: The size of the function's deployment package in bytes.
      type: number
    - contextPath: AWS.Lambda.Functions.Description
      description: The function's description.
      type: string
    - contextPath: AWS.Lambda.Functions.Timeout
      description: The amount of time that Lambda allows a function to run before
        terminating it.
      type: number
    - contextPath: AWS.Lambda.Functions.MemorySize
      description: The memory allocated to the function.
      type: number
    - contextPath: AWS.Lambda.Functions.LastModified
      description: The date and time that the function was last updated, in ISO-8601
        format (YYYY-MM-DDThh:mm:ss.sTZD).
      type: date
    - contextPath: AWS.Lambda.Functions.CodeSha256
      description: The SHA256 hash of the function's deployment package.
      type: string
    - contextPath: AWS.Lambda.Functions.Version
      description: The version of the Lambda function.
      type: string
    - contextPath: AWS.Lambda.Functions.VpcConfig.SubnetIds
      description: A list of VPC subnet IDs.
      type: string
    - contextPath: AWS.Lambda.Functions.VpcConfig.SecurityGroupIds
      description: A list of VPC security groups IDs.
      type: string
    - contextPath: AWS.Lambda.Functions.VpcConfig.VpcId
      description: The ID of the VPC.
      type: string
    - contextPath: AWS.Lambda.Functions.DeadLetterConfig.TargetArn
      description: The Amazon Resource Name (ARN) of an Amazon SQS queue or Amazon
        SNS topic.
      type: string
    - contextPath: AWS.Lambda.Functions.Environment.Variables
      description: Environment variable key-value pairs.
      type: string
    - contextPath: AWS.Lambda.Functions.Environment.Error.ErrorCode
      description: Error messages for environment variables that could not be applied.
        The error code.
      type: string
    - contextPath: AWS.Lambda.Functions.Environment.Error.Message
      description: Error messages for environment variables that could not be applied.
        The error message.
      type: string
    - contextPath: AWS.Lambda.Functions.KMSKeyArn
      description: The KMS key used to encrypt the function's environment variables.
        Only returned if you've configured a customer managed CMK.
      type: string
    - contextPath: AWS.Lambda.Functions.TracingConfig.Mode
      description: The function's AWS X-Ray tracing configuration. The tracing mode.
      type: string
    - contextPath: AWS.Lambda.Functions.MasterArn
      description: The ARN of the master function.
      type: string
    - contextPath: AWS.Lambda.Functions.RevisionId
      description: Represents the latest updated revision of the function or alias.
      type: string
    - contextPath: AWS.Lambda.Functions.Layers.Arn
      description: The Amazon Resource Name (ARN) of the function layer.
      type: string
    - contextPath: AWS.Lambda.Functions.Layers.CodeSize
      description: The size of the layer archive in bytes.
      type: string
    description: Returns a list of your Lambda functions. For each function, the response
      includes the function configuration information. You must use GetFunction to
      retrieve the code for your function.
  - name: aws-lambda-list-aliases
    arguments:
    - name: functionName
      required: true
      description: The name of the lambda function.
    - name: functionVersion
      description: If you specify this optional parameter, the API returns only the
        aliases that are pointing to the specific Lambda function version, otherwise
        the API returns all of the aliases created for the Lambda function.
    outputs:
    - contextPath: AWS.Lambda.Aliases.AliasArn
      description: 'Lambda function ARN that is qualified using the alias name as
        the suffix. '
      type: string
    - contextPath: AWS.Lambda.Aliases.Name
      description: Alias name.
      type: string
    - contextPath: AWS.Lambda.Aliases.FunctionVersion
      description: Function version to which the alias points.
      type: string
    - contextPath: AWS.Lambda.Aliases.Description
      description: Alias description.
      type: string
    - contextPath: AWS.Lambda.Aliases.RoutingConfig.AdditionalVersionWeights
      description: The name of the second alias, and the percentage of traffic that
        is routed to it.
      type: string
    - contextPath: AWS.Lambda.Aliases.RevisionId
      description: Represents the latest updated revision of the function or alias.
      type: string
    description: Returns list of aliases created for a Lambda function. For each alias,
      the response includes information such as the alias ARN, description, alias
      name, and the function version to which it points.
  - name: aws-lambda-invoke
    arguments:
    - name: functionName
      required: true
      description: The name of the Lambda function.
    - name: invocationType
      auto: PREDEFINED
      predefined:
      - Event
      - RequestResponse
      - DryRun
      description: Choose from the following options.  RequestResponse (default) -
        Invoke the function synchronously. Keep the connection open until the function
        returns a response or times out. Event - Invoke the function asynchronously.
        Send events that fail multiple times to the function's dead-letter queue (if
        configured). DryRun - Validate parameter values and verify that the user or
        role has permission to invoke the function.
    - name: logType
      auto: PREDEFINED
      predefined:
      - None
      - Tail
      description: You can set this optional parameter to Tail in the request only
        if you specify the InvocationType parameter with value RequestResponse . In
        this case, AWS Lambda returns the base64-encoded last 4 KB of log data produced
        by your Lambda function in the x-amz-log-result header.
    - name: clientContext
      description: 'Using the ClientContext you can pass client-specific information
        to the Lambda function you are invoking. '
    - name: payload
      description: JSON that you want to provide to your Lambda function as input.
    - name: qualifier
      description: Specify a version or alias to invoke a published version of the
        function.
    outputs:
    - contextPath: AWS.Lambda.InvokedFunctions.FunctionName
      description: The name of the Lambda function.
      type: string
    - contextPath: AWS.Lambda.InvokedFunctions.FunctionError
      description: Indicates whether an error occurred while executing the Lambda
        function. If an error occurred this field will have one of two values; Handled
        or Unhandled . Handled errors are errors that are reported by the function
        while the Unhandled errors are those detected and reported by AWS Lambda.
        Unhandled errors include out of memory errors and function timeouts.
      type: string
    - contextPath: AWS.Lambda.InvokedFunctions.LogResult
      description: logs for the Lambda function invocation. This is present only if
        the invocation type is RequestResponse and the logs were requested.
      type: string
    - contextPath: AWS.Lambda.InvokedFunctions.Payload
      description: It is the JSON representation of the object returned by the Lambda
        function. This is present only if the invocation type is RequestResponse.
      type: string
    - contextPath: AWS.Lambda.InvokedFunctions.ExecutedVersion
      description: The function version that has been executed. This value is returned
        only if the invocation type is RequestResponse.
      type: string
    - contextPath: AWS.Lambda.InvokedFunctions.Region
      description: The AWS Region.
      type: string
    description: Invokes a Lambda function. Specify just a function name to invoke
      the latest version of the function. To invoke a published version, use the Qualifier
      parameter to specify a version or alias .  If you use the RequestResponse (synchronous)
      invocation option, the function will be invoked only once. If you use the Event
      (asynchronous) invocation option, the function will be invoked at least once
      in response to an event and the function must be idempotent to handle this.  For
      functions with a long timeout, your client may be disconnected during synchronous
      invocation while it waits for a response. Configure your demisto server to allow
      for long connections with timeout or keep-alive settings.
    execution: true
  dockerimage: demisto/boto3:1.9.55
  runonce: false
tests:
  - No Tests