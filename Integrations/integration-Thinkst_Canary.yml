commonfields:
  id: Thinkst Canary
  version: -1
name: Thinkst Canary
display: Thinkst Canary
category: Deception
image: data:image/png;base64,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
description: By
configuration:
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
- display: Canary Server URL
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: API auth token
  name: auth_token
  defaultvalue: ""
  type: 4
  required: true
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |-
    ''' IMPORTS '''
    import requests
    import yaml
    import time

    # disable insecure warnings
    requests.packages.urllib3.disable_warnings()

    # remove proxy if not set to true in params
    if not demisto.params()['proxy']:
        del os.environ['HTTP_PROXY']
        del os.environ['HTTPS_PROXY']
        del os.environ['http_proxy']
        del os.environ['https_proxy']

    ''' GLOBALS'''

    SERVER = demisto.params().get('server').rstrip('/') + '/api/v1/'
    AUTH_TOKEN = demisto.params().get('auth_token')
    UNSECURED = demisto.params().get('insecure')
    FETCH_DELTA = 24
    RELEVANT_DEVICE_ENTRIES = {
        'description': 'Description',
        'id': 'ID',
        'ip_address': 'Address',
        'last_seen': 'LastSeen',
        'live': 'Status',
        'location': 'Location',
        'name': 'Name',
        'updated_std': 'LastUpdated',
        'version': 'Version'
    }
    RELEVANT_TOKEN_ENTRIES = {
        'canarytoken': 'CanaryToken',
        'created_printable': 'CreatedTime',
        'enabled': 'Status',
        'kind': 'Kind',
        'triggered_count': 'Triggered',
        'doc_name': 'DocName',
        'url': 'TokenURL'
    }
    session = requests.session()

    '''HELPER FUNCTIONS'''


    def get_alerts(last_fetch=None):
        # Retrieve all unacknowledged alerts from Canary Tools
        params = {
            'auth_token': AUTH_TOKEN,
        }

        if last_fetch:
            params['newer_than'] = last_fetch
        res = session.request('GET', SERVER + 'incidents/unacknowledged', params=params, verify=not UNSECURED).json()
        alerts = res.get('incidents')
        return alerts


    def create_incident(alert):
        # Turns an alert from Canary Tools to the incident structure in Demisto
        incident = {
            'name': alert.get('description').get('description'),
            'occurred': timestamp_to_datestring(1000 * (int(alert.get('description').get('created')))),
            'rawJSON': json.dumps(alert)
        }
        return incident


    '''COMMANDS'''


    def test_module():
        params = {
            'auth_token': AUTH_TOKEN
        }

        res = session.request('GET', SERVER + 'ping', params=params, verify=not UNSECURED).json()
        if res.get('result') == 'success':
            demisto.results('ok')
        else:
            return_error("Test Failed")


    def list_canaries():
        # Retrieve all Canaries available in Canary Tools
        params = {
            'auth_token': AUTH_TOKEN
        }

        res = session.request('GET', SERVER + 'devices/all', params=params, verify=not UNSECURED)
        res_json = yaml.safe_load(res.text)
        new_devices = [
            {new_key: device[old_key] if old_key in device else None for old_key, new_key in RELEVANT_DEVICE_ENTRIES.items()} for
            device in res_json['devices']]
        return res_json, new_devices


    def list_canaries_command():
        res_json, new_devices = list_canaries()
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': res_json,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('Canary Devices', new_devices,
                                             headers=['ID', 'Name', 'Description', 'Address', 'Status', 'Location', 'Version',
                                                      'LastSeen', 'LastUpdated']),
            'EntryContext': {'CanaryTools.Device(val.ID && val.ID == obj.ID)': new_devices}
        })


    def list_tokens():
        # Retrieve all Canary Tokens available in Canary Tools
        params = {
            'auth_token': AUTH_TOKEN
        }

        res = session.request('GET', SERVER + 'canarytokens/fetch', params=params, verify=not UNSECURED)
        res_json = yaml.safe_load(res.text)
        new_tokens = [{new_key: token[old_key] if old_key in token else None for old_key, new_key in RELEVANT_TOKEN_ENTRIES.items()}
                      for token in res_json['tokens'][:-1]]
        return res_json, new_tokens


    def list_tokens_command():
        res_json, new_tokens = list_tokens()
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': res_json,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown('Canary Tools Tokens', new_tokens, headers=sorted(new_tokens[0].keys())),
            'EntryContext': {'CanaryTools.Tokens(val.CanaryToken && val.CanaryToken == obj.CanaryToken)': new_tokens}
        })


    def get_token_command():
        # Fetch a Canary Token from the Canary Tools server
        token = demisto.args().get('token')
        params = {
            'auth_token': AUTH_TOKEN,
            'canarytoken': token
        }

        res = session.request('GET', SERVER + 'canarytoken/fetch', params=params, verify=not UNSECURED).json()
        results = {
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': res,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': 'File Fetched Successfully!',
            'EntryContext': {
                'CanaryTools.Tokens(val.CanaryToken && val.CanaryToken == obj.CanaryToken)': res.get('token').get('canarytoken')}
        }

        if res.get('token').get('doc'):
            name = res.get('token').get('doc_name')
            content = res.get('token').get('doc')
            token_file = fileResult(name, content)
            demisto.results(token_file)
        elif res.get('token').get('web_image'):
            name = res.get('token').get('web_image_name')
            content = res.get('token').get('web_image')
            token_file = fileResult(name, content)
            demisto.results(token_file)
        else:
            results['HumanReadable'] = tableToMarkdown('Canary Tools Tokens', res.get('token'))
        demisto.results(results)


    def check_whitelist(ip, port):
        # Check if a given IP address is whitelisted in Canary Tools
        params = {
            'auth_token': AUTH_TOKEN,
            'src_ip': ip,
            'dst_port': port
        }

        res = session.request('GET', SERVER + 'settings/is_ip_whitelisted', params=params, verify=not UNSECURED).json()
        return res


    def check_whitelist_command():
        ip = demisto.args().get('ip')
        port = demisto.args().get('port')
        res = check_whitelist(ip, port)

        if not port:
            port = 'Any'
        context = {
            'Address': '{}'.format(ip),
            'Port': '{}'.format(port),
            'Whitelisted': '{}'.format(res.get('is_ip_whitelisted'))
        }
        if res.get('is_ip_whitelisted'):
            demisto.results({
                'Type': entryTypes['note'],
                'ContentsFormat': formats['json'],
                'Contents': res,
                'ReadableContentsFormat': formats['markdown'],
                'HumanReadable': 'The IP address ' + '{}'.format(ip) + ':' + '{}'.format(port) + ' is Whitelisted!',
                'EntryContext': {
                    'CanaryTools.IP(val.Address && val.Address == obj.Address && val.Port && val.Port == obj.Port)': context}
            })
        else:
            demisto.results({
                'Type': entryTypes['note'],
                'ContentsFormat': formats['json'],
                'Contents': res,
                'ReadableContentsFormat': formats['markdown'],
                'HumanReadable': 'The IP address ' + '{}'.format(ip) + ':' + '{}'.format(port) + ' is not Whitelisted!',
                'EntryContext': {
                    'CanaryTools.IP(val.Address && val.Address == obj.Address && val.Port && val.Port == obj.Port)': context}
            })


    def whitelist_ip(ip, port):
        # Whitelist an IP address in Canary Tools
        params = {
            'auth_token': AUTH_TOKEN,
            'src_ip': ip,
            'dst_port': port
        }

        res = session.request('POST', SERVER + 'settings/whitelist_ip_port', params=params, verify=not UNSECURED).json()
        return res


    def whitelist_ip_command():
        ip = demisto.args().get('ip')
        port = demisto.args().get('port')
        res = whitelist_ip(ip, port)

        if not port:
            port = 'Any'
        if res.get('result') == 'success':
            context = {
                'Address': '{}'.format(ip),
                'Port': '{}'.format(port),
                'Whitelisted': 'True'
            }
            demisto.results({
                'Type': entryTypes['note'],
                'ContentsFormat': formats['json'],
                'Contents': res,
                'ReadableContentsFormat': formats['markdown'],
                'HumanReadable': 'The IP address ' + '{}'.format(ip) + ':' + '{}'.format(port) + ' was added to the Whitelist!',
                'EntryContext': {
                    'CanaryTools.IP(val.Address && val.Address == obj.Address && val.Port && val.Port == obj.Port)': context}
            })
        elif res.get('result') == 'failure':
            demisto.results({
                'Type': entryTypes['note'],
                'ContentsFormat': formats['json'],
                'Contents': res,
                'ReadableContentsFormat': formats['markdown'],
                'HumanReadable': res.get('message')
            })
        elif res.get('result') == 'error':
            demisto.results({
                'Type': entryTypes['note'],
                'ContentsFormat': formats['json'],
                'Contents': res,
                'ReadableContentsFormat': formats['markdown'],
                'HumanReadable': res.get('message')
            })


    def alert_status_command():
        # Acknowledge or Uncknowledge an Alert in Canary Tools
        args = demisto.args()
        alert = args.get('alertID')
        status = args.get('status')
        context = {
            'ID': '{}'.format(alert),
            'Status': '{}'.format(status),
        }

        if status == 'Acknowledge':
            params = {
                'auth_token': AUTH_TOKEN,
                'incident': alert
            }
            res = session.request('POST', SERVER + 'incident/acknowledge', params=params, verify=not UNSECURED).json()
            if res.get('action') == 'acknowledged':
                demisto.results({
                    'Type': entryTypes['note'],
                    'ContentsFormat': formats['json'],
                    'Contents': res,
                    'ReadableContentsFormat': formats['markdown'],
                    'HumanReadable': 'The Alert {} was '.format(alert) + res.get('action'),
                    'EntryContext': {'CanaryTools.Alert(val.ID && val.ID == obj.ID)': context}
                })
        elif status == 'Unacknowledge':
            params = {
                'auth_token': AUTH_TOKEN,
                'incident': alert
            }
            res = session.request('POST', SERVER + 'incident/unacknowledge', params=params, verify=not UNSECURED).json()
            if res.get('action') == 'unacknowledged':
                demisto.results({
                    'Type': entryTypes['note'],
                    'ContentsFormat': formats['json'],
                    'Contents': res,
                    'ReadableContentsFormat': formats['markdown'],
                    'HumanReadable': 'The Alert {} was '.format(alert) + res.get('action'),
                    'EntryContext': {'CanaryTools.Alert(val.ID && val.ID == obj.ID)': context}
                })
            else:
                demisto.results('Unsopported command')


    def fetch_incidents_command():
        # Fetch alerts from Canary Tools as incidents in Demisto
        last_run = demisto.getLastRun()
        last_fetch = last_run.get('time')

        if last_fetch is None:
            last_fetch = parse_date_range('{} hours'.format(str(FETCH_DELTA)), '%Y-%m-%d-%H:%M:%S')[0]
        alerts = get_alerts(last_fetch)
        incidents = []
        next_fetch = last_fetch

        for alert in alerts:
            current_fetch = 1000 * (int(alert.get('description').get('created')))
            current_fetch = timestamp_to_datestring(current_fetch, '%Y-%m-%d-%H:%M:%S')
            if current_fetch > last_fetch:
                incident = create_incident(alert)
                incidents.append(incident)
            if current_fetch > next_fetch:
                next_fetch = current_fetch
        demisto.incidents(incidents)
        demisto.setLastRun({'time': next_fetch})


    # Execution Code
    try:
        if demisto.command() == 'test-module':
            test_module()
        elif demisto.command() == 'canarytools-list-tokens':
            list_tokens_command()
        elif demisto.command() == 'canarytools-get-token':
            get_token_command()
        elif demisto.command() == 'canarytools-list-canaries':
            list_canaries_command()
        elif demisto.command() == 'canarytools-check-whitelist':
            check_whitelist_command()
        elif demisto.command() == 'canarytools-whitelist-ip':
            whitelist_ip_command()
        elif demisto.command() == 'canarytools-edit-alert-status':
            alert_status_command()
        elif demisto.command() == 'fetch-incidents':
            fetch_incidents_command()
    except Exception, e:
        return_error('Unable to perform command : {}, Reason: {}'.format(demisto.command, e))
  type: python
  commands:
  - name: canarytools-list-canaries
    arguments: []
    outputs:
    - contextPath: CanaryTools.Device.ID
      description: Device ID
      type: string
    - contextPath: CanaryTools.Device.Name
      description: Device Name
      type: string
    - contextPath: CanaryTools.Device.Description
      description: Device Description
      type: string
    - contextPath: CanaryTools.Device.Address
      description: Device IP address
      type: string
    - contextPath: CanaryTools.Device.Status
      description: Device status - Live (True/False)
      type: boolean
    - contextPath: CanaryTools.Device.Location
      description: Device Location
      type: string
    - contextPath: CanaryTools.Device.Version
      description: Device version
      type: string
    - contextPath: CanaryTools.Device.LastSeen
      description: Device Last seen time
      type: date
    - contextPath: CanaryTools.Device.LastUpdated
      description: Device Last updated time
      type: date
    description: List all registered Canaries
  - name: canarytools-list-tokens
    arguments: []
    outputs:
    - contextPath: CanaryTools.Tokens.CanaryToken
      description: Canary Token
      type: string
    - contextPath: CanaryTools.Tokens.CreatedTime
      description: Token Created time
      type: date
    - contextPath: CanaryTools.Tokens.Status
      description: Token status - Enabled (True / False)
      type: boolean
    - contextPath: CanaryTools.Tokens.Kind
      description: Token Kind
      type: string
    - contextPath: CanaryTools.Tokens.Triggered
      description: Token triggered count
      type: number
    - contextPath: CanaryTools.Tokens.DocName
      description: Token document name (If the token is from type document)
      type: string
    - contextPath: CanaryTools.Tokens.TokenURL
      description: Token URL (How the token is presented)
      type: string
    description: List all Canary tokens
  - name: canarytools-check-whitelist
    arguments:
    - name: ip
      required: true
      description: IP address
    - name: port
      description: Destination port
    outputs:
    - contextPath: CanaryTools.IP.Address
      description: IP address
      type: string
    - contextPath: CanaryTools.IP.Port
      description: Destination port for the IP whitelist
      type: string
    - contextPath: CanaryTools.IP.Whitelisted
      description: Is the IP address whitelisted (true/false)
      type: boolean
    description: Check whether a given IP and port are whitelisted
  - name: canarytools-whitelist-ip
    arguments:
    - name: ip
      required: true
      description: IP address to whitelist
    - name: port
      description: Destination port to whitelist
    outputs:
    - contextPath: CanaryTools.IP.Address
      description: IP address
      type: string
    - contextPath: CanaryTools.IP.Port
      description: Destination port for the IP whitelist
      type: string
    - contextPath: CanaryTools.IP.Whitelisted
      description: Is the IP address whitelisted (true/false)
      type: boolean
    description: Whitelist an IP address in Canary
  - name: canarytools-edit-alert-status
    arguments:
    - name: alertID
      required: true
      description: 'Alert ID (i.e : incident:canarytoken:d6fe0ae4dfd36cc3cc6d9d4f::1548593719)' # disable-secrets-detection  
    - name: status
      required: true
      auto: PREDEFINED
      predefined:
      - Acknowledge
      - Unacknowledge
      description: Required status for the alert - Acknowledge, Unacknowledge
    outputs:
    - contextPath: CanaryTools.Alert.ID
      description: Alert ID
      type: string
    - contextPath: CanaryTools.Alert.Status
      description: Alert Status
      type: string
    description: Edit the status for an Alert in Canary Tools
  - name: canarytools-get-token
    arguments:
    - name: token
      required: true
      description: Canary Token
    outputs:
    - contextPath: CanaryTools.Tokens.CanaryToken
      description: Canary Token
      type: string
    - contextPath: File.Size
      description: File Size
      type: string
    - contextPath: File.SHA1
      description: File SHA1
      type: string
    - contextPath: File.SHA256
      description: File SHA256
      type: string
    - contextPath: File.Name
      description: File Name
      type: string
    - contextPath: File.SSDeep
      description: File SSDeep
      type: string
    - contextPath: File.EntryID
      description: File EntryID
      type: string
    - contextPath: File.Info
      description: File Info
      type: string
    - contextPath: File.Type
      description: File Type
      type: string
    - contextPath: File.MD5
      description: File MD5
      type: string
    - contextPath: File.Extension
      description: File Extension
      type: string
    description: Fetch Canary Token file from the Canary Tools server
  isfetch: true
  runonce: false
releaseNotes: "Added new integration."
tests:
  - CanaryTools Test