commonfields:
  id: okta
  version: -1
name: okta
display: okta
category: Authentication
image: data:image/png;base64,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
description: Integration with Okta's cloud-based identity management service
detaileddescription: |-
  To get an API token go to the following URL:
  http://developer.okta.com/docs/api/getting_started/getting_a_token.html
configuration:
- display: okta URL https://<domain.okta.com>
  name: url
  defaultvalue: ""
  type: 0
  required: true
- display: API Token
  name: apitoken
  defaultvalue: ""
  type: 4
  required: true
- display: ' Do not validate server certificate (insecure)'
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |-
    function fixUrl(base) {
        var res = base;
        if (base && base[base.length - 1] !== '/') {
            res = res + '/';
        }
        return res;
    };

    var PROFILE_ARGS = [
        'firstName',
        'lastName',
        'email',
        'login',
        'secondEmail',
        'middleName',
        'honorificPrefix',
        'honorificSuffix',
        'title',
        'displayName',
        'nickName',
        'profileUrl',
        'primaryPhone',
        'mobilePhone',
        'streetAddress',
        'city',
        'state',
        'zipCode',
        'countryCode',
        'postalAddress',
        'preferredLanguage',
        'locale',
        'timezone',
        'userType',
        'employeeNumber',
        'costCenter',
        'organization',
        'division',
        'department',
        'managerId',
        'manager'
    ];

    var SERVER_URL = fixUrl(params.url) + 'api/v1/';
    var DEFAULT_SEARCH_LIMIT = 200;

    function logsToMarkdown(title, contents){
        var md = title + '\n';
        if(!(contents.length > 0)){
            return md + 'No events found';
        }

        md += tableToMarkdown('Event Details', contents.map(function(content){
            return logToHumanReadable(content);
        }));

        return md;
    }

    function logToHumanReadable(logObject){
        var flattened = {};
        var md = '';
        var keys = Object.keys(logObject);
        keys.forEach(function(key){
            log(key);

           // md += tableToMarkdown(key, logObject[key]);
            if(logObject[key] instanceof Array){
                flattened[pascalToSpace(key)] = flattenValue(logObject[key], 0, true);
            }
            else{
                flattened[pascalToSpace(key)] = logObject[key];
            }
        });

        return flattened;
    }

    function createVerboseLog(log){
        var logObject = {};

        if(log.actor){
            logObject.Actor = {};
            logObject.Actor.AlternateId = log.actor.alternateId;
            logObject.Actor.DisplayName = log.actor.displayName;
            logObject.Actor.ID = log.actor.id;
        }

        if(log.client){
            logObject.Client = {};
            if(log.client.userAgent){
                logObject.Client.RawUserAgent = log.client.userAgent.rawUserAgent;
                logObject.Client.OS = log.client.userAgent.os;
                logObject.Client.Browser = log.client.userAgent.browser;
            }
            logObject.Client.Device = log.client.device;
            logObject.Client.ID = log.client.ID;
            logObject.Client.IPAddress = log.client.ipAddress;
            if(log.client.geographicalContext){
                logObject.Client.City = log.client.geographicalContext.city;
                logObject.Client.State = log.client.geographicalContext.state;
                logObject.Client.Country = log.client.geographicalContext.country;
            }
        }

        logObject.Event = {};

        logObject.Event.DisplayMessage = log.displayMessage;
        logObject.Event.EventType = log.eventType;
        logObject.Event.OutcomeResult = log.outcome.result;
        logObject.Event.OutcomeReason = log.outcome.reason;
        logObject.Event.Published = log.published;
        logObject.Event.Severity = log.severity;
        if(log.securityContext.asNumber){
            logObject.Event.SecurityContextAsNumber = log.securityContext.asNumber;
        }
        if(log.securityContext.asOrg){
            logObject.Event.SecurityContextAsOrg = log.securityContext.asOrg;
        }
        if(log.securityContext.isp){
            logObject.Event.SecurityContextISP = log.securityContext.isp;
        }
        if(log.SecurityContextDomain){
            logObject.Event.SecurityContextDomain = log.securityContext.domain;
        }
        if(log.securityContext.domain){
            logObject.Event.SecurityContextIsProxy = log.securityContext.isProxy;
        }
        if(log.authenticationContext){
            if(log.authenticationContext.authenticationProvider){
                logObject.Event.AuthenticationProvider = log.authenticationContext.authenticationProvider;
            }
            if(log.authenticationContext.credentialProvider){
                logObject.Event.CredentialProvider = log.authenticationContext.credentialProvider;
            }
            if(log.authenticationContext.credentialType){
                logObject.Event.CredentialType = log.authenticationContext.credentialType;
            }
            if(log.authenticationContext.issuer){
                logObject.Event.AuthenticationIssuer = log.authenticationContext.issuer;
            }
            if(log.authenticationContext.interface){
                logObject.Event.AuthenticationInterface = log.authenticationContext.interface;
            }
            if(log.authenticationContext.authenticationStep){
                logObject.Event.AuthenticationStep = log.authenticationContext.authenticationStep;
            }
            if(log.authenticationContext.externalSessionId){
                logObject.Event.ExternalSessionId = log.authenticationContext.externalSessionId;
            }
        }
        logObject.Event.uuid = log.uuid;


        if(log.request.ipChain){
            var ipChain = log.request.ipChain.map(function(ip){
                return {
                    IP: ip.ip,
                    City: ip.geographicalContext.city,
                    State: ip.geographicalContext.state,
                    Country: ip.geographicalContext.country,
                    Version: ip.version,
                    Source: ip.source
                };
            });

            logObject.RequestIPChain = ipChain;
        }

        if(log.target){
            var targets = log.target.map(function(target){
                return {
                    ID: target.id,
                    Type: target.type,
                    AlternateId: target.alternateId,
                    DisplayName: target.displayName
                }
            });

            logObject.Targets = targets;
        }

        return logObject;
    }

    function createReadableLog(log){
        var logObject = {};

        logObject.Time = log.published;//dateToString(Date.parse(log.published), '%m-%d-%Y %H:%M:%S');
        logObject.Actor = log.actor.displayName + ' (' + log.actor.type + ')';
        logObject.EventInfo = log.displayMessage + ' - ' + log.outcome.result + (log.outcome.reason ? ': ' + log.outcome.reason : '');

        var targets = '';
            if(log.target){
            log.target.forEach(function(target){
               targets += target.displayName + ' (' + target.type + ')\n';
            });
        }

        logObject.Targets = targets || '-';
        logObject.uuid = log.uuid;

        return logObject;
    };

    function buildProfile(args) {
        var profile = {};
        var keys = Object.keys(args);
        for (var i = 0 ; i < PROFILE_ARGS.length; i++) {
            if (args[PROFILE_ARGS[i]]) {
                profile[PROFILE_ARGS[i]] = args[PROFILE_ARGS[i]];
            }
        }
        return profile;
    };

    function buildCredentials(args) {
        var creds = {};
        if (args.password) {
            var  pswd = { value: args.password };
            creds.password = pswd;
        }
        if (args.passwordQuestion || args.passwordAnswer) {
            var recovery = {
                question: args.passwordQuestion,
                answer: args.passwordAnswer
            };
            creds.recovery_question = recovery;
        }
        if (args.providerName || args.providerType) {
            var provider = {
                name: args.providerName,
                type: args.providerType
            };
            creds.provider = provider;
        }
        return creds;
    };

    function identLevel(count) {
        var ret='';
        for (var i=0;i<count;i++) {
            ret += '     ';
        }
        return ret;
    };

    function flattenValue(value, level, isArray) {
        if (!level) {
            level=0;
        }
        if (!value || value === '') {
            return '<br>';
        } else if (typeof value === 'string') {
            return value + '<br>';
        } else {
            var ret = (level>0) ? (identLevel(level-1) + (isArray ? '' : '{') + ' <br>') : '';
            for (var key in value) {
                ret += identLevel(level) + (isArray ? '' : key + ': ') + flattenValue(value[key],level+1,isArray);
            }
            return (level>0) ? (ret + identLevel(level-1) + (isArray ? '' : '}') + '<br>') : ret;
        }

    };

    function profileToMd(profile) {
        var head = '|';
        var line = '|';
        var data = '|';

        for (var key in profile) {
            head += key + '|';
            line += '-|';
            data += profile[key] + '|';
        }
        return head + '\n' + line + '\n' + data + '\n';
    };

    function usersToMd(users, verbose) {
        var md='';

        if (!Array.isArray(users)) {
            users = [users] ;
        }

        var user;
        if (verbose==='true') {
            for (var i=0;i<users.length;i++) {
                user=users[i];
                md += '### User: ' + user.profile.login +'\n';
                md += '#### Profile:\n';
                md += profileToMd(user.profile);
                md += '#### Additional data:\n';
                md += 'Key|Value\n-|-\n';
                for (var key in user) {
                    if (key !== 'profile') {
                        md += key+'|'+flattenValue(user[key]) + '\n';
                    }
                }
            }
        } else {
            md += 'ID|Login|First Name|Last Name|Mobile Phone|Last Login|Status\n-|-|-|-|-|-|-\n';
            for (var i=0;i<users.length;i++) {
                user = users[i];
                md += user.id + '|';
                md += user.profile.login + '|';
                md += user.profile.firstName+'|';
                md += user.profile.lastName+'|';
                md += user.profile.mobilePhone+'|';
                md += user.lastLogin+'|';
                md += user.status+'\n';
            }
        }
        return md;
    };

    function usersToEc(users) {

        var ec={};
        ec.Account = [];
        if (!Array.isArray(users)) {
            users = [users] ;
        }
        for (var i=0;i<users.length;i++) {
            var user=users[i];
            var ecItem={id:user.id,Type:'Okta'};
            if (user.profile.firstName || user.profile.lastName) {
                var displayName='';
                displayName += (user.profile.firstName)? user.profile.firstName + ' ' : '';
                displayName += (user.profile.lastName)? user.profile.lastName : '';
                ecItem.DisplayName = displayName.trim();
            }
            if (user.profile.email) {
                ecItem.Email = user.profile.email;
            }
            if (user.profile.login) {
                ecItem.Username = user.profile.login;
            }
            if (user.objectClass) {
                ecItem.Groups = user.objectClass;
            }
            ec.Account.push(ecItem);
        }
        return ec;
    };


    function sendRequest(path, method, queryParams, body, pagination){
        var url = SERVER_URL.concat(path);
        var query = '';
        if(queryParams){
            query = encodeToURLQuery(queryParams);
        }

        url = url.concat(query);

        log(url);

        var res = http(
            url,
            {
                Method: method ? method : 'GET',
                Headers: {
                    Authorization: ['SSWS ' + params.apitoken],
                    Accept: ['application/json'],
                    'Content-Type': ['application/json']
                },
                Body: body ? JSON.stringify(body) : body
            },
            params.insecure
        );
        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Failed on request ' + url + ' , request status code: ' + res.StatusCode + ' and Body: ' + res.Body + '.';
        }

        if(pagination){
            return {
                body: JSON.parse(res.Body),
                link: res.Headers['Link']
            };
        }

        if(!(res.Body)){
            return '';
        }

        return JSON.parse(res.Body);
    };

    function getUserIdRequest(username){
        var uri = 'users?filter=' + encodeURIComponent('profile.login eq "' + username + '"');
        var res = sendRequest(uri);
        if (res && res.length && res.length === 1) {
            return res[0].id;
        } else {
            throw 'Unable to find userId ' + username + '\n' + JSON.stringify(res);
        }
    };

    function unlockUser(){
        var userId = getUserIdRequest(args.username);

        var res = unlockUserRequest(userId);

        var md = "### Okta user unlocked: " + args.username + '\n';
        md += 'User ID: ' + userId + '\n';
        return {
            Type: entryTypes.note,
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };


    function unlockUserRequest(userId){
        var uri = 'users/' + userId + '/lifecycle/unlock';
        return sendRequest(uri, 'POST');
    };

    function deactivateUser() {
        var userId = getUserIdRequest(args.username);

        var res = deactivateUserRequest(userId);

        var md = "### Okta user deactivated: " + args.username + '\n';
        md += 'User ID: ' + userId + '\n';
        return {
            Type: entryTypes.note,
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };

    function deactivateUserRequest(userId){
        var uri = 'users/' + userId + '/lifecycle/deactivate';

        return sendRequest(uri, 'POST');
    };

    function activateUser(){
        var userId = getUserIdRequest(args.username);

        var res = activateUserRequest(userId);

        var md = "### Okta user activated: " + args.username + '\n';
        md += 'User ID: ' + userId + '\n';
        return {
            Type: entryTypes.note,
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };

    function activateUserRequest(userId) {
        var uri = 'users/' + userId + '/lifecycle/activate';

        return sendRequest(uri, 'POST');
    };

    function getGroups() {
        var userId = getUserIdRequest(args.username);

        var res = getGroupsRequest(userId);

        var groups = [];
        res.forEach(function(resGroup){
            var group = {
                ID: resGroup.id,
                Created: resGroup.created,
                ObjectClass: resGroup.objectClass,
                LastUpdated: resGroup.lastUpdated,
                LastMembershipUpdated: resGroup.lastMembershipUpdated,
                Type: resGroup.type,
                Name: resGroup.profile.name,
                Description: resGroup.profile.description
            };

            groups.push(group);
        });

        var ec = {
            Group: groups,
            ID: userId,
            Type: 'Okta'
        };

        var md = "### Okta groups for user " + args.username + '\n';
        md += 'User ID: ' + userId + '\n';;
        md += tableToMarkdown('Groups', groups);
        return {
            Type: entryTypes.note,
            entryContext: {
                'Account(val.ID==obj.ID)' : ec
            },
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };

    function getGroupsRequest(userId) {
        var uri = 'users/' + userId + '/groups';

        return sendRequest(uri);
    };

    function addUserToGroup(){
        var groupId = args.groupId;
        var userId = args.userId;

        var res = addUserToGroupRequest(userId, groupId);

        return 'Succesfully added user to group';
    }

    function addUserToGroupRequest(userId, groupId){
        var uri = 'groups/' + groupId + '/users/' + userId;

        return sendRequest(uri, 'PUT');
    }

    function removeUserFromGroup(){
        var groupId = args.groupId;
        var userId = args.userId;

        var res = removeUserFromGroupRequest(userId, groupId);

        return 'Succesfully removed user from group';
    }

    function removeUserFromGroupRequest(userId, groupId){
        var uri = 'groups/' + groupId + '/users/' + userId;

        return sendRequest(uri, 'DELETE');
    }

    function setPassword(){
        var userId = getUserIdRequest(args.username);

        var res = setPasswordRequest(userId, args.password);

        var md = "### Okta user password set: " + args.username + '\n';
        md += 'User ID: ' + userId + '\n';
        return {
            Type: entryTypes.note,
            Contents: res,
            ContentsFormat:
            formats.json,
            HumanReadable: md
        };
    };

    function setPasswordRequest(userId, password) {
        var uri = 'users/' + userId;
        var body =  {
            "credentials": {
                "password" : { "value": password }
            }
        };

        return sendRequest(uri, 'POST', body);
    };

    function search(){
        var limit = args.limit ? args.limit : DEFAULT_SEARCH_LIMIT;
        var term = args.term ? encodeURIComponent(args.term) : args.term;

        var res = searchRequest(term, limit);

        var md;
        var ec;
        if (res && res.length>0) {
            md = '### Okta users found:\n';
            md += usersToMd(res, args.verbose);
            ec = usersToEc(res);
        }
        else {
            md = '### No users found in Okta\n';
        }

        return {
            Type: entryTypes.note,
            EntryContext: ec,
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };

    function searchRequest(term, limit) {
        var uri = 'users?q=' + term + '&limit=' + limit;

        return sendRequest(uri);
    };

    function getUser(){
        var term = args.username ? encodeURIComponent(args.username) : args.userid;

        if (!term) {
            throw "You must supply either 'username' or 'userid'";
        }

        var res = getUserRequest(term);

        var md = '### Okta user:\n';
        md += usersToMd(res,args.verbose);
        var ec = usersToEc(res);
        return {
            Type: entryTypes.note,
            EntryContext: ec,
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };

    function getUserRequest(term){
        var uri = 'users/' + term;

        return sendRequest(uri);
    };

    function createUser(){
        var cred = buildCredentials(args);
        var profile = buildProfile(args);
        var groupIds = args.groupIds;
        if (groupIds) {
            groupIds = groupIds.split(',');
        }

        var activate = false;
        if (args.activate) {
            activate = args.activate.toLowerCase() === 'true';
        }

        var res = createUserRequest(cred, profile, groupIds, activate);

        var md = "### Okta user created: " + args.login + '\n';
        md += profileToMd(res.profile);
        var ec = usersToEc(res);
        return {
            Type: entryTypes.note,
            EntryContext: ec,
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };

    function createUserRequest(cred, profile, groupIds, activate) {
        var body = {
            profile: profile,
            groupIds: groupIds,
            credentials: cred
        };

        var uri = 'users?activate=' + activate;
        if (cred && cred.provider) {
            uri += '&provider=true';
        }

        return sendRequest(uri, 'POST', body);
    };

    function updateUser() {
        var userId = getUserIdRequest(args.username);
        var cred = buildCredentials(args);
        var profile = buildProfile(args);
        profile.login = args.username;

        var md = "### Okta user updated: " + args.username + '\n';
        md += 'User ID: ' + userId + '\n';
        md += profileToMd(res.profile);
        return {
            Type: entryTypes.note,
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };

    function updateUserRequest(userId, profile, cred){
        var body = {
            profile: profile,
            credentials: cred
        };

        var uri = 'users/' + userId;

        return sendRequest(uri, 'POST', body, true);
    };

    function getLogs(filter, query, since, until, sortOrder)
    {
        var logs = [];
        var queryParams = {};

        if(filter){
            queryParams.filter =  encodeURIComponent(filter);
        }

        if(query){
            queryParams.q = encodeURIComponent(query);
        }

        if(since){
            queryParams.since = since;
        }

        if(until){
            queryParams.until = until;
        }

        if(sortOrder){
            queryParams.sortOrder = sortOrder;
        }

        do {
            var resObject = sendRequest('logs', 'GET', queryParams, '', true);
            logs = logs.concat(resObject.body);
            var link = resObject.link;

            if(link.length < 2){
                // No next page
                break;
            }
            else{
                // Get the next page for the results
                var afterPattern = /\bafter=(.*)>/;
                var linkMatch = link[1].match(afterPattern);
                if(!linkMatch){
                    break;
                }

                queryParams['after'] = linkMatch[1];
            }

        } while(resObject.body.length > 0)

        return logs;
    }

    function getFailedLoginsCommand(){
        var readableLogs = [];
        var filter = 'eventType eq "user.session.start" and outcome.result eq "FAILURE"';
        var logs = getLogs(filter, args.query, args.since, args.until, args.sortOrder);

        if(!logs || logs.length === 0){
            return 'No events found';
        }

        for(var i = 0; i < logs.length; i++){
            readableLogs.push(createReadableLog(logs[i]));
        }

        var md = logsToMarkdown("Failed Login events", readableLogs);

        return {
            Type: entryTypes.note,
            Contents: logs,
            ContentsFormat: formats.json,
            EntryContext: {
                'Okta.Logs.FailedLogins(val.uuid==obj.uuid)' : logs
            },
            HumanReadable: md
        };
    }

    function getGroupAssignmentsCommand(){
        var readableLogs = [];
        var filter = 'eventType eq "group.user_membership.add"';
        var logs = getLogs(filter, args.query, args.since, args.until, args.sortOrder);

        if(!logs || logs.length === 0){
            return 'No events found';
        }

        for(var i = 0; i < logs.length; i++){
            readableLogs.push(createReadableLog(logs[i]));
        }

        var md = tableToMarkdown("Group assignment events", readableLogs);

        return {
            Type: entryTypes.note,
            Contents: logs,
            ContentsFormat: formats.json,
            EntryContext: {
                'Okta.Logs.GroupAssignments(val.uuid==obj.uuid)' : logs
            },
            HumanReadable: md
        };
    }


    function getApplicationAssignmentsCommand(){
        var readableLogs = [];
        var filter = 'eventType eq "application.user_membership.add"';
        var logs = getLogs(filter, args.query, args.since, args.until, args.sortOrder);

        if(!logs || logs.length === 0){
            return 'No events found';
        }

        for(var i = 0; i < logs.length; i++){
            readableLogs.push(createReadableLog(logs[i]));
        }

        var md = tableToMarkdown("Application assignment events", readableLogs);

        return {
            Type: entryTypes.note,
            Contents: logs,
            ContentsFormat: formats.json,
            EntryContext: {
                'Okta.Logs.ApplicationAssignments(val.uuid==obj.uuid)' : logs
            },
            HumanReadable: md
        };
    }


    function getApplicationAuthenticationCommand(){
        var readableLogs = [];
        var filter = 'eventType eq "user.authentication.sso"';
        var logs = getLogs(filter, args.query, args.since, args.until, args.sortOrder);

        if(!logs || logs.length === 0){
            return 'No events found';
        }

        for(var i = 0; i < logs.length; i++){
            readableLogs.push(createReadableLog(logs[i]));
        }

        var md = tableToMarkdown("Application authentication events", readableLogs);

        return {
            Type: entryTypes.note,
            Contents: logs,
            ContentsFormat: formats.json,
            EntryContext: {
                'Okta.Logs.ApplicationAuthentication(val.uuid==obj.uuid)' : logs
            },
            HumanReadable: md
        };
    };

    function getLogsCommand(){
        var readableLogs = [];
        var logs = getLogs(args.filter, args.query, args.since, args.until, args.sortOrder);

        if(!logs || logs.length === 0){
            return 'No events found';
        }

        for(var i = 0; i < logs.length; i++){
            readableLogs.push(createReadableLog(logs[i]));
        }

        var md = tableToMarkdown("Okta events", readableLogs);

        return {
            Type: entryTypes.note,
            Contents: logs,
            ContentsFormat: formats.json,
            EntryContext: {
                'Okta.Logs.Events(val.uuid==obj.uuid)' : logs
            },
            HumanReadable: md
        };
    }

    function getVerboseLogsCommand(){
        var verboseLogs = [];
        var query = args.uuid;
        var logs = getLogs(args.filter, query, args.since, args.until, args.sortOrder);

        if(!logs || logs.length === 0){
            return 'No events found';
        }

        for(var i = 0; i < logs.length; i++){
            verboseLogs.push(createVerboseLog(logs[i]));
        }

        var md = logsToMarkdown("Verbose details for log " + args.uuid, verboseLogs);

        return {
            Type: entryTypes.note,
            Contents: logs,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    }


    function test() {
        var uri = 'users?limit=1';
        var res = sendRequest(uri);

        return res ? 'ok' : 'not ok';
    }

    var entry;
    switch (command){
        case 'test-module':
            return test();
        case 'okta-unlock-user':
            entry = unlockUser();
            break;
        case 'okta-deactivate-user':
            entry = deactivateUser();
            break;
        case 'okta-activate-user':
            entry = activateUser();
            break;
        case 'okta-get-groups':
            entry = getGroups();
            break;
        case 'okta-set-password':
            entry = setPassword();
            break;
        case 'okta-search':
            entry = search();
            break;
        case 'okta-get-user':
            entry = getUser();
            break;
        case 'okta-create-user':
            entry = createUser();
            break;
        case 'okta-update-user':
            entry = updateUser();
            break;
        case 'okta-get-failed-logins':
            entry = getFailedLoginsCommand();
            break;
        case 'okta-get-group-assignments':
            entry = getGroupAssignmentsCommand();
            break;
        case 'okta-get-application-assignments':
            entry = getApplicationAssignmentsCommand();
            break;
        case 'okta-get-application-authentication':
            entry = getApplicationAuthenticationCommand();
            break;
        case 'okta-add-to-group':
            entry = addUserToGroup();
            break;
        case 'okta-remove-from-group':
            entry = removeUserFromGroup();
        case 'okta-get-logs':
            entry = getLogsCommand();
            break;
        case 'okta-get-verbose-log':
            entry = getVerboseLogsCommand();
            break;
    }

    return entry;
  type: javascript
  commands:
  - name: okta-unlock-user
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to unlock
    description: Unlock user
    execution: true
  - name: okta-deactivate-user
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to deactivate
    description: Deactivate user
    execution: true
  - name: okta-activate-user
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to activate
    description: Activate user
    execution: true
  - name: okta-get-groups
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to get groups for
    outputs:
    - contextPath: Account.Group
      description: Okta groups the account is associated with
    - contextPath: Account.ID
      description: Okta account ID
    - contextPath: Account.Type
      description: Account type - Okta
    - contextPath: Account.Group.ID
      description: Unique key for group
    - contextPath: Account.Group.Created
      description: Timestamp when group was created
    - contextPath: Account.Group.ObjectClass
      description: Determines the group’s profile
    - contextPath: Account.Group.LastUpdated
      description: Timestamp when group’s profile was last updated
    - contextPath: Account.Group.LastMembershipUpdated
      description: Timestamp when group’s memberships were last updated
    - contextPath: Account.Group.Type
      description: Determines how a group’s profile and memberships are managed
    - contextPath: Account.Group.Name
      description: Name of the group
    - contextPath: Account.Group.Description
      description: Description of the group
    description: Get all user groups
  - name: okta-set-password
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to get groups for
    - name: password
      required: true
      description: The new password to set for the user
    description: Set a new password for user
    execution: true
  - name: okta-search
    arguments:
    - name: term
      required: true
      default: true
      description: Term to search for, this term can be first name, last name or email
    - name: limit
      description: Max number of results to return (defaults to 200)
    - name: verbose
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Print all details of users that match search term
    outputs:
    - contextPath: Account.ID
      description: Okta account IDs returned by search
    - contextPath: Account.Username
      description: Okta account usernames returned by search
    - contextPath: Account.Email
      description: Okta account emails returned by search
    - contextPath: Accout.DisplayName
      description: Okta account display names returned by search
    - contextPath: Account.Type
      description: Account type returned by search - Okta
    description: Search for Okta users
  - name: okta-get-user
    arguments:
    - name: username
      description: Username of requested user, please note that this will not work
        for usernames that contains a '/' character
    - name: userid
      description: User ID of requested user
    - name: verbose
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Print all details of user
    outputs:
    - contextPath: Account.ID
      description: Okta account ID
    - contextPath: Account.Email
      description: Okta account email
    - contextPath: Account.Username
      description: Okta account username
    - contextPath: Account.DisplayName
      description: Okta account display name
    - contextPath: Account.Type
      description: Account type - Okta
    description: Fetches a specific user when you know the user’s login, please note
      that one of the parameters bellow is mandatory.
  - name: okta-create-user
    arguments:
    - name: firstName
      required: true
      description: Given name of the user (givenName)
    - name: lastName
      required: true
      description: Family name of the user (familyName)
    - name: email
      required: true
      description: primary email address of user
    - name: login
      required: true
      description: Unique identifier for the user (username)
    - name: secondEmail
      description: Secondary email address of user typically used for account recovery
    - name: middleName
      description: "Middle name(s) of the user\t"
    - name: honorificPrefix
      description: Honorific prefix(es) of the user, or title in most Western languages
    - name: honorificSuffix
      description: honorific suffix(es) of the user
    - name: title
      description: User’s title, such as “Vice President”
    - name: displayName
      description: Name of the user, suitable for display to end-users
    - name: nickName
      description: Casual way to address the user in real life
    - name: profileUrl
      description: Url of user’s online profile (e.g. a web page)
    - name: primaryPhone
      description: "Primary phone number of user such as home number\t"
    - name: mobilePhone
      description: mobile phone number of user
    - name: streetAddress
      description: Full street address component of user’s address
    - name: city
      description: City or locality component of user’s address (locality)
    - name: state
      description: State or region component of user’s address (region)
    - name: zipCode
      description: Zipcode or postal code component of user’s address (postalCode)
    - name: countryCode
      description: Country name component of user’s address (country)
    - name: postalAddress
      description: Mailing address component of user’s address
    - name: preferredLanguage
      description: User’s preferred written or spoken languages
    - name: locale
      description: User’s default location for purposes of localizing items such as
        currency, date time format, numerical representations, etc.
    - name: timezone
      description: User’s time zone
    - name: userType
      description: Used to identify the organization to user relationship such as
        “Employee” or “Contractor”
    - name: employeeNumber
      description: Organization or company assigned unique identifier for the user
    - name: costCenter
      description: name of a cost center assigned to
    - name: organization
      description: Name of user’s organization
    - name: division
      description: Name of user’s division
    - name: department
      description: Name of user’s department
    - name: managerId
      description: ID of a user’s manager
    - name: manager
      description: DisplayName of the user’s manager
    - name: password
      description: Password for new user
    - name: passwordQuestion
      description: Password question for new user
    - name: passwordAnswer
      description: Password answer for question supplied
    - name: providerType
      auto: PREDEFINED
      predefined:
      - OKTA
      - ACTIVE_DIRECTORY
      - LDAP
      - FEDERATION
      - SOCIAL
      description: OKTA, ACTIVE_DIRECTORY,LDAP, FEDERATION, or SOCIAL
    - name: providerName
      description: Name of provider
    - name: groupIds
      description: Ids of groups that user will be immediately added to at time of
        creation (Do not include default group)
    - name: activate
      description: Executes activation lifecycle operation when creating the user
    outputs:
    - contextPath: Account.ID
      description: Created okta account ID
    - contextPath: Account.Email
      description: Created okta account email
    - contextPath: Account.Username
      description: Created okta account username
    - contextPath: Account.DisplayName
      description: Created okta account display name
    - contextPath: Account.Type
      description: Type of create account - Okta
    description: Creates a new user with an option of setting password, recovery question
      and answer. The new user will immediately be able to login after activation
      with the assigned password. This flow is common when developing a custom user
      registration experience.
    execution: true
  - name: okta-update-user
    arguments:
    - name: firstName
      description: Given name of the user (givenName)
    - name: lastName
      description: Family name of the user (familyName)
    - name: email
      description: primary email address of user
    - name: username
      required: true
      description: Unique identifier for the user (login)
    - name: secondEmail
      description: Secondary email address of user typically used for account recovery
    - name: middleName
      description: "Middle name(s) of the user\t"
    - name: honorificPrefix
      description: Honorific prefix(es) of the user, or title in most Western languages
    - name: honorificSuffix
      description: honorific suffix(es) of the user
    - name: title
      description: User’s title, such as “Vice President”
    - name: displayName
      description: Name of the user, suitable for display to end-users
    - name: nickName
      description: Casual way to address the user in real life
    - name: profileUrl
      description: Url of user’s online profile (e.g. a web page)
    - name: primaryPhone
      description: "Primary phone number of user such as home number\t"
    - name: mobilePhone
      description: mobile phone number of user
    - name: streetAddress
      description: Full street address component of user’s address
    - name: city
      description: City or locality component of user’s address (locality)
    - name: state
      description: State or region component of user’s address (region)
    - name: zipCode
      description: Zipcode or postal code component of user’s address (postalCode)
    - name: countryCode
      description: Country name component of user’s address (country)
    - name: postalAddress
      description: Mailing address component of user’s address
    - name: "preferredLanguage\t"
      description: User’s preferred written or spoken languages
    - name: locale
      description: User’s default location for purposes of localizing items such as
        currency, date time format, numerical representations, etc.
    - name: "timezone\t"
      description: User’s time zone
    - name: userType
      description: Used to identify the organization to user relationship such as
        “Employee” or “Contractor”
    - name: employeeNumber
      description: Organization or company assigned unique identifier for the user
    - name: costCenter
      description: name of a cost center assigned to
    - name: organization
      description: Name of user’s organization
    - name: division
      description: Name of user’s division
    - name: department
      description: Name of user’s department
    - name: managerId
      description: ID of a user’s manager
    - name: manager
      description: DisplayName of the user’s manager
    - name: password
      description: Password for new user
    - name: passwordQuestion
      description: Password question for new user
    - name: passwordAnswer
      description: Password answer for question supplied
    - name: providerType
      auto: PREDEFINED
      predefined:
      - OKTA
      - ACTIVE_DIRECTORY
      - LDAP
      - FEDERATION
      - SOCIAL
      description: OKTA, ACTIVE_DIRECTORY,LDAP, FEDERATION, or SOCIAL
    - name: providerName
      description: Name of provider
    description: Update user with a given login, all fields are optional, fields which
      are not set will not be overriden
    execution: true
  - name: okta-get-failed-logins
    arguments:
    - name: since
      description: 'Filters the lower time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: until
      description: 'Filters the upper time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: sortOrder
      auto: PREDEFINED
      predefined:
      - ASCENDING
      - DESCENDING
      description: The order of the returned events, default is ASCENDING
    outputs:
    - contextPath: Okta.Logs.FailedLogins.ActorAlternateId
      description: Log actor alternate Id
    - contextPath: Okta.Logs.FailedLogins.ActorDisplayName
      description: Log actor display name
    - contextPath: Okta.Logs.FailedLogins.ActorID
      description: Log actor Id
    - contextPath: Okta.Logs.FailedLogins.ClientRawUserAgent
      description: Log client raw user agent
    - contextPath: Okta.Logs.FailedLogins.ClientOS
      description: Log client OS
    - contextPath: Okta.Logs.FailedLogins.ClientBrowser
      description: Log client browser
    - contextPath: Okta.Logs.FailedLogins.ClientDevice
      description: Log client device
    - contextPath: Okta.Logs.FailedLogins.ClientID
      description: Log Client Id
    - contextPath: Okta.Logs.FailedLogins.ClientIPAddress
      description: Log client IP Address
    - contextPath: Okta.Logs.FailedLogins.ClientCity
      description: Log client city
    - contextPath: Okta.Logs.FailedLogins.ClientState
      description: Log client state
    - contextPath: Okta.Logs.FailedLogins.ClientCountry
      description: Log client country
    - contextPath: Okta.Logs.FailedLogins.DisplayMessage
      description: Log display message
    - contextPath: Okta.Logs.FailedLogins.EventType
      description: Log event type
    - contextPath: Okta.Logs.FailedLogins.OutcomeResult
      description: Log outcome result
    - contextPath: Okta.Logs.FailedLogins.OutcomeReason
      description: Log outcome reason
    - contextPath: Okta.Logs.FailedLogins.Published
      description: Log publish date in ISO 8601
    - contextPath: Okta.Logs.FailedLogins.Severity
      description: Log severity
    - contextPath: Okta.Logs.FailedLogins.SecurityContextAsNumber
      description: Log security context as number
    - contextPath: Okta.Logs.FailedLogins.SecurityContextAsOrg
      description: Log security context as org
    - contextPath: Okta.Logs.FailedLogins.SecurityContextISP
      description: Log security context ISP
    - contextPath: Okta.Logs.FailedLogins.SecurityContextDomain
      description: Log security context domain
    - contextPath: Okta.Logs.FailedLogins.SecurityContextIsProxy
      description: Log security context is proxy
    - contextPath: Okta.Logs.FailedLogins.RequestIPChain.IP
      description: Log request IP Chain IP address
    - contextPath: Okta.Logs.FailedLogins.RequestIPChain.City
      description: Log request IP Chain city
    - contextPath: Okta.Logs.FailedLogins.RequestIPChain.State
      description: Log request IP Chain state
    - contextPath: Okta.Logs.FailedLogins.RequestIPChain.Country
      description: Log request IP Chain country
    - contextPath: Okta.Logs.FailedLogins.RequestIPChain.Source
      description: Log request IP Chain source
    - contextPath: Okta.Logs.FailedLogins.Targets.ID
      description: Log target ID
    - contextPath: Okta.Logs.FailedLogins.Targets.Type
      description: Log target type
    - contextPath: Okta.Logs.FailedLogins.Targets.AlternateId
      description: Log target alternate Id
    - contextPath: Okta.Logs.FailedLogins.Targets.DisplayName
      description: Log target display name
    description: Get events for when Okta issued a session to a user who is authenticating
      and the user failed to log-in
  - name: okta-get-group-assignments
    arguments:
    - name: since
      description: 'Filters the lower time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: until
      description: 'Filters the upper time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: sortOrder
      auto: PREDEFINED
      predefined:
      - ASCENDING
      - DESCENDING
      description: The order of the returned events, default is ASCENDING
    outputs:
    - contextPath: Okta.Logs.GroupAssignments.ActorAlternateId
      description: Log actor alternate Id
    - contextPath: Okta.Logs.GroupAssignments.ActorDisplayName
      description: Log actor display name
    - contextPath: Okta.Logs.GroupAssignments.ActorID
      description: Log actor Id
    - contextPath: Okta.Logs.GroupAssignments.ClientRawUserAgent
      description: Log client raw user agent
    - contextPath: Okta.Logs.GroupAssignments.ClientOS
      description: Log client OS
    - contextPath: Okta.Logs.GroupAssignments.ClientBrowser
      description: Log client browser
    - contextPath: Okta.Logs.GroupAssignments.ClientDevice
      description: Log client device
    - contextPath: Okta.Logs.GroupAssignments.ClientID
      description: Log Client Id
    - contextPath: Okta.Logs.GroupAssignments.ClientIPAddress
      description: Log client IP Address
    - contextPath: Okta.Logs.GroupAssignments.ClientCity
      description: Log client city
    - contextPath: Okta.Logs.GroupAssignments.ClientState
      description: Log client state
    - contextPath: Okta.Logs.GroupAssignments.ClientCountry
      description: Log client country
    - contextPath: Okta.Logs.GroupAssignments.DisplayMessage
      description: Log display message
    - contextPath: Okta.Logs.GroupAssignments.EventType
      description: Log event type
    - contextPath: Okta.Logs.GroupAssignments.OutcomeResult
      description: Log outcome result
    - contextPath: Okta.Logs.GroupAssignments.OutcomeReason
      description: Log outcome reason
    - contextPath: Okta.Logs.GroupAssignments.Published
      description: Log publish date in ISO 8601
    - contextPath: Okta.Logs.GroupAssignments.Severity
      description: Log severity
    - contextPath: Okta.Logs.GroupAssignments.SecurityContextAsNumber
      description: Log security context as number
    - contextPath: Okta.Logs.GroupAssignments.SecurityContextAsOrg
      description: Log security context as org
    - contextPath: Okta.Logs.GroupAssignments.SecurityContextISP
      description: Log security context ISP
    - contextPath: Okta.Logs.GroupAssignments.SecurityContextDomain
      description: Log security context domain
    - contextPath: Okta.Logs.GroupAssignments.SecurityContextIsProxy
      description: Log security context is proxy
    - contextPath: Okta.Logs.GroupAssignments.RequestIPChain.IP
      description: Log request IP Chain IP address
    - contextPath: Okta.Logs.GroupAssignments.RequestIPChain.City
      description: Log request IP Chain city
    - contextPath: Okta.Logs.GroupAssignments.RequestIPChain.State
      description: Log request IP Chain state
    - contextPath: Okta.Logs.GroupAssignments.RequestIPChain.Country
      description: Log request IP Chain country
    - contextPath: Okta.Logs.GroupAssignments.RequestIPChain.Source
      description: Log request IP Chain source
    - contextPath: Okta.Logs.GroupAssignments.Targets.ID
      description: Log target ID
    - contextPath: Okta.Logs.GroupAssignments.Targets.Type
      description: Log target type
    - contextPath: Okta.Logs.GroupAssignments.Targets.AlternateId
      description: Log target alternate Id
    - contextPath: Okta.Logs.GroupAssignments.Targets.DisplayName
      description: Log target display name
    description: Get events for when a user was added to a group.
  - name: okta-get-application-assignments
    arguments:
    - name: since
      description: 'Filters the lower time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: until
      description: 'Filters the upper time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: sortOrder
      auto: PREDEFINED
      predefined:
      - ASCENDING
      - DESCENDING
      description: The order of the returned events, default is ASCENDING
    outputs:
    - contextPath: Okta.Logs.ApplicationAssignments.ActorAlternateId
      description: Log actor alternate Id
    - contextPath: Okta.Logs.ApplicationAssignments.ActorDisplayName
      description: Log actor display name
    - contextPath: Okta.Logs.ApplicationAssignments.ActorID
      description: Log actor Id
    - contextPath: Okta.Logs.ApplicationAssignments.ClientRawUserAgent
      description: Log client raw user agent
    - contextPath: Okta.Logs.ApplicationAssignments.ClientOS
      description: Log client OS
    - contextPath: Okta.Logs.ApplicationAssignments.ClientBrowser
      description: Log client browser
    - contextPath: Okta.Logs.ApplicationAssignments.ClientDevice
      description: Log client device
    - contextPath: Okta.Logs.ApplicationAssignments.ClientID
      description: Log Client Id
    - contextPath: Okta.Logs.ApplicationAssignments.ClientIPAddress
      description: Log client IP Address
    - contextPath: Okta.Logs.ApplicationAssignments.ClientCity
      description: Log client city
    - contextPath: Okta.Logs.ApplicationAssignments.ClientState
      description: Log client state
    - contextPath: Okta.Logs.ApplicationAssignments.ClientCountry
      description: Log client country
    - contextPath: Okta.Logs.ApplicationAssignments.DisplayMessage
      description: Log display message
    - contextPath: Okta.Logs.ApplicationAssignments.EventType
      description: Log event type
    - contextPath: Okta.Logs.ApplicationAssignments.OutcomeResult
      description: Log outcome result
    - contextPath: Okta.Logs.ApplicationAssignments.OutcomeReason
      description: Log outcome reason
    - contextPath: Okta.Logs.ApplicationAssignments.Published
      description: Log publish date in ISO 8601
    - contextPath: Okta.Logs.ApplicationAssignments.Severity
      description: Log severity
    - contextPath: Okta.Logs.ApplicationAssignments.SecurityContextAsNumber
      description: Log security context as number
    - contextPath: Okta.Logs.ApplicationAssignments.SecurityContextAsOrg
      description: Log security context as org
    - contextPath: Okta.Logs.ApplicationAssignments.SecurityContextISP
      description: Log security context ISP
    - contextPath: Okta.Logs.ApplicationAssignments.SecurityContextDomain
      description: Log security context domain
    - contextPath: Okta.Logs.ApplicationAssignments.SecurityContextIsProxy
      description: Log security context is proxy
    - contextPath: Okta.Logs.ApplicationAssignments.RequestIPChain.IP
      description: Log request IP Chain IP address
    - contextPath: Okta.Logs.ApplicationAssignments.RequestIPChain.City
      description: Log request IP Chain city
    - contextPath: Okta.Logs.ApplicationAssignments.RequestIPChain.State
      description: Log request IP Chain state
    - contextPath: Okta.Logs.ApplicationAssignments.RequestIPChain.Country
      description: Log request IP Chain country
    - contextPath: Okta.Logs.ApplicationAssignments.RequestIPChain.Source
      description: Log request IP Chain source
    - contextPath: Okta.Logs.ApplicationAssignments.Targets.ID
      description: Log target ID
    - contextPath: Okta.Logs.ApplicationAssignments.Targets.Type
      description: Log target type
    - contextPath: Okta.Logs.ApplicationAssignments.Targets.AlternateId
      description: Log target alternate Id
    - contextPath: Okta.Logs.ApplicationAssignments.Targets.DisplayName
      description: Log target display name
    description: Get events for when a user was assigned to an application.
  - name: okta-get-application-authentication
    arguments:
    - name: since
      description: 'Filters the lower time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: until
      description: 'Filters the upper time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: sortOrder
      auto: PREDEFINED
      predefined:
      - ASCENDING
      - DESCENDING
      description: The order of the returned events, default is ASCENDING
    outputs:
    - contextPath: Okta.Logs.ApplicationAuthentication.ActorAlternateId
      description: Log actor alternate Id
    - contextPath: Okta.Logs.ApplicationAuthentication.ActorDisplayName
      description: Log actor display name
    - contextPath: Okta.Logs.ApplicationAuthentication.ActorID
      description: Log actor Id
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientRawUserAgent
      description: Log client raw user agent
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientOS
      description: Log client OS
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientBrowser
      description: Log client browser
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientDevice
      description: Log client device
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientID
      description: Log Client Id
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientIPAddress
      description: Log client IP Address
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientCity
      description: Log client city
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientState
      description: Log client state
    - contextPath: Okta.Logs.ApplicationAuthentication.ClientCountry
      description: Log client country
    - contextPath: Okta.Logs.ApplicationAuthentication.DisplayMessage
      description: Log display message
    - contextPath: Okta.Logs.ApplicationAuthentication.EventType
      description: Log event type
    - contextPath: Okta.Logs.ApplicationAuthentication.OutcomeResult
      description: Log outcome result
    - contextPath: Okta.Logs.ApplicationAuthentication.OutcomeReason
      description: Log outcome reason
    - contextPath: Okta.Logs.ApplicationAuthentication.Published
      description: Log publish date in ISO 8601
    - contextPath: Okta.Logs.ApplicationAuthentication.Severity
      description: Log severity
    - contextPath: Okta.Logs.ApplicationAuthentication.SecurityContextAsNumber
      description: Log security context as number
    - contextPath: Okta.Logs.ApplicationAuthentication.SecurityContextAsOrg
      description: Log security context as org
    - contextPath: Okta.Logs.ApplicationAuthentication.SecurityContextISP
      description: Log security context ISP
    - contextPath: Okta.Logs.ApplicationAuthentication.SecurityContextDomain
      description: Log security context domain
    - contextPath: Okta.Logs.ApplicationAuthentication.SecurityContextIsProxy
      description: Log security context is proxy
    - contextPath: Okta.Logs.ApplicationAuthentication.RequestIPChain.IP
      description: Log request IP Chain IP address
    - contextPath: Okta.Logs.ApplicationAuthentication.RequestIPChain.City
      description: Log request IP Chain city
    - contextPath: Okta.Logs.ApplicationAuthentication.RequestIPChain.State
      description: Log request IP Chain state
    - contextPath: Okta.Logs.ApplicationAuthentication.RequestIPChain.Country
      description: Log request IP Chain country
    - contextPath: Okta.Logs.ApplicationAuthentication.RequestIPChain.Source
      description: Log request IP Chain source
    - contextPath: Okta.Logs.ApplicationAuthentication.Targets.ID
      description: Log target ID
    - contextPath: Okta.Logs.ApplicationAuthentication.Targets.Type
      description: Log target type
    - contextPath: Okta.Logs.ApplicationAuthentication.Targets.AlternateId
      description: Log target alternate Id
    - contextPath: Okta.Logs.ApplicationAuthentication.Targets.DisplayName
      description: Log target display name
    description: Get events for when a user attempted to SSO to an application managed
      in Okta
  - name: okta-add-to-group
    arguments:
    - name: userId
      description: ID of the user to add
    - name: groupId
      description: ID of the group to add the user to
    description: Adds a user to a group with OKTA_GROUP type.
  - name: okta-remove-from-group
    arguments:
    - name: userId
      description: ID of the user to remove
    - name: groupId
      description: ID of the group to remove the user from
    description: Removes a user from a group with OKTA_GROUP type.
  - name: okta-get-verbose-log
    arguments:
    - name: uuid
      required: true
      description: The uuid of the log to retrieve
    description: Retrieve detailed information for specific log entry
  - name: okta-get-logs
    arguments:
    - name: filter
      description: 'The filter to use, for example eventType eq "user.session.start"
        and outcome.result eq "FAILURE" '
    - name: query
      description: A query to search the logs for
    - name: since
      description: 'Filters the lower time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: until
      description: 'Filters the upper time bound of the log events in the Internet
        Date/Time Format profile of ISO 8601. An example: 2017-05-03T16:22:18Z'
    - name: sortOrder
      auto: PREDEFINED
      predefined:
      - ASCENDING
      - DESCENDING
      description: The order of the returned events, default is ASCENDING
    description: Get logs by providing optional filters
  runonce: false
releaseNotes: "-"
fromversion: 3.5.0