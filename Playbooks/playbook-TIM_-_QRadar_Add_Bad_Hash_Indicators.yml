id: TIM - QRadar Add Bad Hash Indicators
version: -1
fromversion: 5.5.0
name: TIM - QRadar Add Bad Hash Indicators
description: This playbook queries indicators based on a pre-defined query or results
  from a parent playbook, and adds the resulting indicators to a QRadar Reference
  Set. The Reference Set name must be defined in the playbook inputs.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 65d05933-9eba-42d2-8f6b-189892a23f2b
    type: start
    task:
      id: 65d05933-9eba-42d2-8f6b-189892a23f2b
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 340,
          "y": -310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "3":
    id: "3"
    taskid: 4b789a00-9288-4603-8c2d-fdfbedb5a0ff
    type: title
    task:
      id: 4b789a00-9288-4603-8c2d-fdfbedb5a0ff
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 340,
          "y": 1510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: 3316e680-e6f3-4c12-8d0e-3ebcf966d904
    type: condition
    task:
      id: 3316e680-e6f3-4c12-8d0e-3ebcf966d904
      version: -1
      name: Is QRadarEnabled?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "49"
      - "50"
      - "51"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: QRadar
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 580,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "18":
    id: "18"
    taskid: 66ae0283-ad6b-4e58-8684-027bdfae6105
    type: condition
    task:
      id: 66ae0283-ad6b-4e58-8684-027bdfae6105
      version: -1
      name: Are there filtered results?
      description: ''
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "9"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: playbookQuery
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: playbookQuery.indicator_type
                      iscontext: true
                    right:
                      value:
                        simple: File
                - - operator: isEqualString
                    left:
                      value:
                        simple: playbookQuery.CustomFields.tags
                      iscontext: true
                    right:
                      value:
                        simple: approved_black
                accessor: value
            iscontext: true
    view: |-
      {
        "position": {
          "x": 340,
          "y": -100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: f407fa15-9658-44cd-82f8-7c5aba6a3ccb
    type: regular
    task:
      id: f407fa15-9658-44cd-82f8-7c5aba6a3ccb
      version: -1
      name: Add Sha256 to QRadar reference set
      description: Add or update a value in a reference set.
      script: '|||qradar-update-reference-set-value'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "52"
    scriptarguments:
      date_value: {}
      ref_name:
        simple: ${inputs.QRadarSha256ReferenceSetName}
      source: {}
      value:
        complex:
          root: playbookQuery
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.indicator_type
                iscontext: true
              right:
                value:
                  simple: Sha256
            - operator: stringHasLength
              left:
                value:
                  simple: playbookQuery.value
                iscontext: true
              right:
                value:
                  simple: "64"
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.CustomFields.tags
                iscontext: true
              right:
                value:
                  simple: approved_black
          accessor: value
          transformers:
          - operator: uniq
      values:
        complex:
          root: playbookQuery
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: playbookQuery.value
                iscontext: true
              right:
                value:
                  simple: "64"
          accessor: value
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 860,
          "y": 1130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: 774e7065-e732-4306-8643-20c17e552a21
    type: condition
    task:
      id: 774e7065-e732-4306-8643-20c17e552a21
      version: -1
      name: Is there a Qradar Sha256 Reference Set?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "35"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.QRadarSha256ReferenceSetName
            iscontext: true
    view: |-
      {
        "position": {
          "x": 920,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "35":
    id: "35"
    taskid: 1767af56-1f3e-4b58-8ef8-f1e5c76662f4
    type: condition
    task:
      id: 1767af56-1f3e-4b58-8ef8-f1e5c76662f4
      version: -1
      name: Are there Sha256 results?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "26"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: playbookQuery
                filters:
                - - operator: stringHasLength
                    left:
                      value:
                        simple: playbookQuery.value
                      iscontext: true
                    right:
                      value:
                        simple: "64"
                  - operator: isEqualString
                    left:
                      value:
                        simple: playbookQuery.CustomFields.tags
                      iscontext: true
                    right:
                      value:
                        simple: Sha256
                - - operator: isEqualString
                    left:
                      value:
                        simple: playbookQuery.CustomFields.tags
                      iscontext: true
                    right:
                      value:
                        simple: approved_black
                accessor: value
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1250,
          "y": 960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "36":
    id: "36"
    taskid: 85512dc5-e523-4c34-8276-e44194bb7400
    type: condition
    task:
      id: 85512dc5-e523-4c34-8276-e44194bb7400
      version: -1
      name: Is there a Qradar Sha1 Reference Set?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "37"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.QRadarSha1ReferenceSetName
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "37":
    id: "37"
    taskid: 1df74856-3bc7-4efd-8e55-e936f0d2b0c0
    type: condition
    task:
      id: 1df74856-3bc7-4efd-8e55-e936f0d2b0c0
      version: -1
      name: Are there Sha1 results?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "38"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: playbookQuery
                filters:
                - - operator: stringHasLength
                    left:
                      value:
                        simple: playbookQuery.value
                      iscontext: true
                    right:
                      value:
                        simple: "40"
                - - operator: isEqualString
                    left:
                      value:
                        simple: playbookQuery.CustomFields.tags
                      iscontext: true
                    right:
                      value:
                        simple: Sha1
                - - operator: isEqualString
                    left:
                      value:
                        simple: playbookQuery.CustomFields.tags
                      iscontext: true
                    right:
                      value:
                        simple: approved_black
                accessor: value
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2110,
          "y": 960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "38":
    id: "38"
    taskid: d62471ca-49c6-4d61-8c7a-cc89e58da0f4
    type: regular
    task:
      id: d62471ca-49c6-4d61-8c7a-cc89e58da0f4
      version: -1
      name: Add Sha1 to QRadar reference set
      description: Add or update a value in a reference set.
      script: '|||qradar-update-reference-set-value'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      date_value: {}
      ref_name:
        simple: ${inputs.QRadarSha1ReferenceSetName}
      source: {}
      value:
        complex:
          root: playbookQuery
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: playbookQuery.value
                iscontext: true
              right:
                value:
                  simple: "40"
            - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.CustomFields.tags
                iscontext: true
              right:
                value:
                  simple: Sha1
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.CustomFields.tags
                iscontext: true
              right:
                value:
                  simple: approved_black
          accessor: value
          transformers:
          - operator: uniq
      values:
        complex:
          root: playbookQuery
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: playbookQuery.value
                iscontext: true
              right:
                value:
                  simple: "40"
          accessor: value
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1750,
          "y": 1130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "39":
    id: "39"
    taskid: 4afd17b4-fabe-4984-8f3a-65decee07ed8
    type: condition
    task:
      id: 4afd17b4-fabe-4984-8f3a-65decee07ed8
      version: -1
      name: Is there a Qradar Md5 Reference Set?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "40"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.QRadarMd5ReferenceSetName
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2660,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "40":
    id: "40"
    taskid: d4df9a62-2d77-4f6e-8b79-0fb170d34164
    type: condition
    task:
      id: d4df9a62-2d77-4f6e-8b79-0fb170d34164
      version: -1
      name: Are there Md5 results?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "41"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: playbookQuery
                filters:
                - - operator: stringHasLength
                    left:
                      value:
                        simple: playbookQuery.value
                      iscontext: true
                    right:
                      value:
                        simple: "32"
                  - operator: isEqualString
                    left:
                      value:
                        simple: playbookQuery.CustomFields.tags
                      iscontext: true
                    right:
                      value:
                        simple: Md5
                - - operator: isEqualString
                    left:
                      value:
                        simple: playbookQuery.CustomFields.tags
                      iscontext: true
                    right:
                      value:
                        simple: approved_black
                accessor: value
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2950,
          "y": 960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "41":
    id: "41"
    taskid: 3bb81028-f888-44f3-8267-a4e1f0240fc9
    type: regular
    task:
      id: 3bb81028-f888-44f3-8267-a4e1f0240fc9
      version: -1
      name: Add Md5 to QRadar reference set
      description: Add or update a value in a reference set.
      script: '|||qradar-update-reference-set-value'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      date_value: {}
      ref_name:
        simple: ${inputs.QRadarMd5ReferenceSetName}
      source: {}
      value:
        complex:
          root: playbookQuery
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.CustomFields.tags
                iscontext: true
              right:
                value:
                  simple: Md5
            - operator: stringHasLength
              left:
                value:
                  simple: playbookQuery.value
                iscontext: true
              right:
                value:
                  simple: "32"
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.CustomFields.tags
                iscontext: true
              right:
                value:
                  simple: approved_black
          accessor: value
          transformers:
          - operator: uniq
      values:
        complex:
          root: playbookQuery
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: playbookQuery.value
                iscontext: true
              right:
                value:
                  simple: "32"
          accessor: value
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2590,
          "y": 1130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "49":
    id: "49"
    taskid: 7195254d-6057-4ee3-852d-9ffb8ad62265
    type: title
    task:
      id: 7195254d-6057-4ee3-852d-9ffb8ad62265
      version: -1
      name: Sha256
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 920,
          "y": 550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "50":
    id: "50"
    taskid: c88d9831-13c8-49fb-8e49-a5a9fe9b8b66
    type: title
    task:
      id: c88d9831-13c8-49fb-8e49-a5a9fe9b8b66
      version: -1
      name: Sha1
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "36"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "51":
    id: "51"
    taskid: 3c57bcd9-6855-437c-86e9-53d954945de6
    type: title
    task:
      id: 3c57bcd9-6855-437c-86e9-53d954945de6
      version: -1
      name: Md5
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "39"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2660,
          "y": 550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "52":
    id: "52"
    taskid: 80a523cf-5d4a-4651-8455-333ee88c27a5
    type: regular
    task:
      id: 80a523cf-5d4a-4651-8455-333ee88c27a5
      version: -1
      name: Add SIEM tag
      description: Adds the SIEM tag to the indicator.
      script: Builtin|||appendIndicatorField
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: SIEM
      indicatorsValues:
        complex:
          root: playbookQuery
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.indicator_type
                iscontext: true
              right:
                value:
                  simple: Sha256
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.CustomFields.tags
                iscontext: true
              right:
                value:
                  simple: approved_black
          accessor: value
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 680,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "53":
    id: "53"
    taskid: f6ab4e64-779d-400f-8bab-fa21b4e16a4a
    type: regular
    task:
      id: f6ab4e64-779d-400f-8bab-fa21b4e16a4a
      version: -1
      name: Add SIEM tag
      description: Adds the SIEM tag to the indicator.
      script: Builtin|||appendIndicatorField
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: SIEM
      indicatorsValues:
        complex:
          root: playbookQuery
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.indicator_type
                iscontext: true
              right:
                value:
                  simple: Sha1
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.CustomFields.tags
                iscontext: true
              right:
                value:
                  simple: approved_black
          accessor: value
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1560,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "54":
    id: "54"
    taskid: 79f3b533-142b-439f-8447-e33c31b9b1ac
    type: regular
    task:
      id: 79f3b533-142b-439f-8447-e33c31b9b1ac
      version: -1
      name: Add SIEM tag
      description: Adds the SIEM tag to the indicator.
      script: Builtin|||appendIndicatorField
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: SIEM
      indicatorsValues:
        complex:
          root: playbookQuery
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.indicator_type
                iscontext: true
              right:
                value:
                  simple: Md5
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.CustomFields.tags
                iscontext: true
              right:
                value:
                  simple: approved_black
          accessor: value
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2410,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1885,
        "width": 2990,
        "x": 340,
        "y": -310
      }
    }
  }
inputs:
- key: QRadarMd5ReferenceSetName
  value: {}
  required: false
  description: The name of the QRadar Md5 reference set to insert the data in to.
  playbookInputQuery: null
- key: QRadarSha1ReferenceSetName
  value: {}
  required: false
  description: The name of the QRadar Sha1 reference set to insert the data in to.
  playbookInputQuery: null
- key: QRadarSha256ReferenceSetName
  value:
    simple: Demisto Demo Sha256
  required: false
  description: The name of the QRadar Sha256 reference set to insert the data in to.
  playbookInputQuery: null
- key: ""
  value: {}
  required: false
  description: ""
  playbookInputQuery:
    query: ""
    queryEntity: indicators
    results: null
    daterange:
      fromdate: 0001-01-01T00:00:00Z
      todate: 0001-01-01T00:00:00Z
      period:
        by: ""
        byto: ""
        byfrom: ""
        tovalue: null
        fromvalue: null
        field: ""
      fromdatelicenseval: 0001-01-01T00:00:00Z
    runFromLastJobTime: false
outputs: []
quiet: true
tests:
- No test