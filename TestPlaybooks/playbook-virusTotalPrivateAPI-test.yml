id: virusTotalPrivateAPI-test-playbook
version: -1
name: virusTotalPrivateAPI-test-playbook
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 68c5fdac-085c-4dc3-8509-6e99dcb65e48
    type: start
    task:
      id: 68c5fdac-085c-4dc3-8509-6e99dcb65e48
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "12":
    id: "12"
    taskid: ec21b629-d1b3-46bc-8492-ab7598af8236
    type: title
    task:
      id: ec21b629-d1b3-46bc-8492-ab7598af8236
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "14":
    id: "14"
    taskid: 548fd4b3-da94-436f-8699-6de9f36333d8
    type: regular
    task:
      id: 548fd4b3-da94-436f-8699-6de9f36333d8
      version: -1
      name: vt-get-domain-report
      description: Retrieves a report on a given domain (including the information
        recorded by VirusTotal's passive DNS infrastructure).
      script: '|||vt-private-get-domain-report'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      domain:
        simple: google.com
      fullResponse: {}
      threshold: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "16":
    id: "16"
    taskid: 2d85ea53-7449-4678-8352-d688a72c48bf
    type: condition
    task:
      id: 2d85ea53-7449-4678-8352-d688a72c48bf
      version: -1
      name: Verify Domain Whois Contains
      description: "Checks whether substring is within string. Returns: \nyes - string
        contains substring. \nno - string does not contain substring. \nIf stringSeperator
        is provided, the substring will be split using the separator, and each item
        will be checked.\nIf one of the items will be found in the string, the srcipt
        will return yes.\n"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "31"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsString
          left:
            value:
              complex:
                root: Domain
                accessor: VirusTotal.Whois
            iscontext: true
          right:
            value:
              simple: GOOGLE
    view: |-
      {
        "position": {
          "x": 50,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "17":
    id: "17"
    taskid: 98c54a30-faab-4a47-817d-1fe8aeed0906
    type: regular
    task:
      id: 98c54a30-faab-4a47-817d-1fe8aeed0906
      version: -1
      name: vt-get-file-report
      description: Retrieves a concluded url scan report for a given url.
      script: '|||vt-private-get-file-report'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      allInfo: {}
      resource:
        simple: 65d7c8c92a2dce75ba037bb6f89258fdd5f786dfe36d0315fdb7e6f31ad78d36
      shortFormat: {}
      threshold: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "18":
    id: "18"
    taskid: 7f7b221f-b2ac-4e17-8992-750ebc04955f
    type: condition
    task:
      id: 7f7b221f-b2ac-4e17-8992-750ebc04955f
      version: -1
      name: Verify File Malicious
      description: |-
        Verifies path in context:
        - Verifies path existence
        - If matching object is an array: verify fields exists in each of the objects in the array
        - If matching object is not an array: verify fields exists in matching object
        - if 'expectedValue' is given: ensure that the given value is equal to the context path
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "21"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: File
                accessor: Malicious
            iscontext: true
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1595
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "20":
    id: "20"
    taskid: 4e320282-23e9-4e3b-88b5-fd109756d0f6
    type: regular
    task:
      id: 4e320282-23e9-4e3b-88b5-fd109756d0f6
      version: -1
      name: vt-private-get-url-report
      description: Retrieves a concluded url scan report for a given url.
      script: '|||vt-private-get-url-report'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      allInfo: {}
      fullResponse: {}
      resource:
        simple: http://En-us.secureconnection.moneytransaction.kb4.io
      retries: {}
      retry_time: {}
      shortFormat: {}
      threshold: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "21":
    id: "21"
    taskid: 03aabdf1-7e2d-47bc-8aa5-9eda08ddeb39
    type: regular
    task:
      id: 03aabdf1-7e2d-47bc-8aa5-9eda08ddeb39
      version: -1
      name: DeleteContext
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "22":
    id: "22"
    taskid: 3e40e9a0-166d-4b5a-88dc-33eb1d93c50b
    type: regular
    task:
      id: 3e40e9a0-166d-4b5a-88dc-33eb1d93c50b
      version: -1
      name: vt-private-get-ip-report
      description: Retrieves a report on a given IP address (including the information
        recorded by VirusTotal's Passive DNS infrastructure).
      script: '|||vt-private-get-ip-report'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      fullResponse: {}
      ip:
        simple: 139.130.4.5
      threshold: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "23":
    id: "23"
    taskid: 0b892b49-1289-4f4b-899c-74321fcc7e8e
    type: condition
    task:
      id: 0b892b49-1289-4f4b-899c-74321fcc7e8e
      version: -1
      name: Verify DBot Score of ip
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "12"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: DBotScore
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "1"
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2645
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "24":
    id: "24"
    taskid: ea73bbf2-dccc-40d6-86c3-679c835d9360
    type: regular
    task:
      id: ea73bbf2-dccc-40d6-86c3-679c835d9360
      version: -1
      name: Sleep
      description: Sleep for X seconds
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      seconds:
        simple: "60"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "25":
    id: "25"
    taskid: 2ee3117c-f30d-4dc8-8407-a4306fba8dc5
    type: regular
    task:
      id: 2ee3117c-f30d-4dc8-8407-a4306fba8dc5
      version: -1
      name: DeleteContext
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "27":
    id: "27"
    taskid: 43c3ef08-d652-485f-8f1f-58950032f770
    type: regular
    task:
      id: 43c3ef08-d652-485f-8f1f-58950032f770
      version: -1
      name: Delete Context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "30":
    id: "30"
    taskid: 452e6580-a221-44a9-8abc-841a2751c995
    type: playbook
    task:
      id: 452e6580-a221-44a9-8abc-841a2751c995
      version: -1
      name: Polling an uploaded file
      description: |-
        Use this playbook as a sub-playbook to block execution of the master playbook until a remote action is complete.
        This playbook implements polling by continuously running the command in Step \#2 until the operation completes.
        The remote action should have the following structure:

        1. Initiate the operation.
        2. Poll to check if the operation completed.
        3. (optional) Get the results of the operation.
      playbookName: GenericPolling
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      AdditionalPollingCommandArgNames: {}
      AdditionalPollingCommandArgValues: {}
      Ids:
        simple: ${vtScanID}
      Interval:
        simple: "1"
      PollingCommandArgName:
        simple: resource
      PollingCommandName:
        simple: vt-private-get-file-report
      Timeout:
        simple: "10"
      dt:
        simple: VirusTotal(val.Status!=='Ready').ID
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "31":
    id: "31"
    taskid: b6dec92d-adc7-4bd7-8c28-f4fcad00b10c
    type: regular
    task:
      id: b6dec92d-adc7-4bd7-8c28-f4fcad00b10c
      version: -1
      name: Get a file to upload
      description: |
        Will create a file (using the given data input or entry ID) and upload it to current investigation war room.
      scriptName: FileCreateAndUpload
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      data:
        simple: Cool data
      entryId: {}
      filename:
        simple: VT_file_test.txt
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "32":
    id: "32"
    taskid: 0fd3e26d-c1f9-44fa-8190-014df8c7b37a
    type: regular
    task:
      id: 0fd3e26d-c1f9-44fa-8190-014df8c7b37a
      version: -1
      name: Load file to vt
      description: Submits a file for scanning.
      script: '|||file-scan'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      entryID:
        simple: ${File.EntryID}
      uploadURL: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "33":
    id: "33"
    taskid: be0e29d3-48bb-4144-8967-7a8ebaa12efc
    type: regular
    task:
      id: be0e29d3-48bb-4144-8967-7a8ebaa12efc
      version: -1
      name: DeleteContext
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2835,
        "width": 380,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
