category: Authentication
commonfields:
  id: Netcraft
  version: -1
configuration:
- display: Use system proxy
  name: proxy
  required: false
  type: 8
- display: Username
  name: username
  required: true
  type: 4
- display: Password
  name: password
  required: true
  type: 4
- defaultvalue: '100'
  display: The max number of entries (takedowns / notes) that can be returned. Default
    is 100.
  name: limit
  required: false
  type: 0
description: Integration Template
display: Netcraft
name: Netcraft
script:
  commands:
  - arguments:
    - default: false
      description: The attack location you want taken down e.g. a phishing URL or
        fraudulent email address.
      isArray: false
      name: attack
      required: true
      secret: false
    - default: false
      description: The reason for submission, such as a description of the attack.
      isArray: false
      name: comment
      required: true
      secret: false
    deprecated: false
    description: Report an attack to Netcraft
    execution: false
    name: netcraft-report-attack
    outputs:
    - contextPath: Netcraft.Takedown.DateSubmitted
      description: The date and time of reporting.
      type: String
    - contextPath: Netcraft.Takedown.LastUpdated
      description: The date and time of the last action taken on the takedown.
      type: String
    - contextPath: Netcraft.Takedown.EvidenceURL
      description: The URL of the evidence page on incident.netcraft.com.
      type: String
    - contextPath: Netcraft.Takedown.Reporter
      description: The person/account that submitted the takedown.
      type: String
    - contextPath: Netcraft.Takedown.Domain
      description: The domain of the URL or email address being taken down. This will
        be blank for attacks with no domain name.
      type: String
    - contextPath: Netcraft.Takedown.Hostname
      description: The full hostname of the URL or email address being taken down.
        This will be blank for attacks with no hostname.
      type: String
    - contextPath: Netcraft.Takedown.CountryCode
      description: ISO country code of the hosting country.
      type: String
    - contextPath: Netcraft.Takedown.DomainAttack
      description: Whether or not the domain is believed to be fraudulent.
      type: String
    - contextPath: Netcraft.Takedown.TargetedURL
      description: The URL which this attack is masquarading as, e.g. the URL of the
        legitimate login form that the attack targets.
      type: String
    - contextPath: Netcraft.Takedown.Certificate
      description: HTTPS certificate details for the hostname, or null if no certificate
        was found. The value returned is the output of PHP's openssl_x509_parse function.
      type: Unknown
    - contextPath: Netcraft.Takedown.ID
      description: The takedown's ID.
      type: Number
    - contextPath: Netcraft.Takedown.GroupID
      description: The takedown's group ID, can potentially be the same as id or empty
        if there is no group.
      type: Number
    - contextPath: Netcraft.Takedown.Status
      description: The status of the takedown.
      type: String
    - contextPath: Netcraft.Takedown.AttackType
      description: The type of takedown.
      type: String
    - contextPath: Netcraft.Takedown.AttackURL
      description: The location of the attack being taken down.
      type: String
    - contextPath: Netcraft.Takedown.Region
      description: The customer area that the attack resides in.
      type: String
    - contextPath: Netcraft.Takedown.IP
      description: The IPv4 address of the attack.
      type: String
  - arguments:
    - default: false
      description: The ID of the takedowns you wish to get information for.
      isArray: false
      name: id
      required: false
      secret: false
    - default: false
      description: 'The date which you''d only like to recieve info about takedowns
        that were submitted after it. Format: YYYY-MM-DD HH:MM:SS.'
      isArray: false
      name: date_from
      required: false
      secret: false
    - default: false
      description: 'The date which you''d only like to recieve info about takedowns
        that were updated after it. Format: YYYY-MM-DD HH:MM:SS.'
      isArray: false
      name: updated_since
      required: false
      secret: false
    - default: false
      description: The URL you'd like to filter by.
      isArray: false
      name: url
      required: false
      secret: false
    - default: false
      description: The IP you'd like to filter by.
      isArray: false
      name: ip
      required: false
      secret: false
    - default: false
      description: The specific region you'd like to filter by. If the region is invalid
        or not specified then all regions are shown.
      isArray: false
      name: region
      required: false
      secret: false
    deprecated: false
    description: Get information on existing takedowns. The takedown ID can be received
      when you report the malicious URL and open the takedown, from the netcraft-report-attack
      command.
    execution: false
    name: netcraft-get-takedown-info
    outputs:
    - contextPath: Netcraft.Takedown.ID
      description: The takedown's ID.
      type: number
    - contextPath: Netcraft.Takedown.GroupID
      description: The takedown's group ID, can potentially be the same as id or empty
        if there is no group.
      type: number
    - contextPath: Netcraft.Takedown.Status
      description: The status of the takedown.
      type: string
    - contextPath: Netcraft.Takedown.AttackType
      description: The type of takedown.
      type: string
    - contextPath: Netcraft.Takedown.AttackURL
      description: The location of the attack being taken down.
      type: string
    - contextPath: Netcraft.Takedown.Region
      description: The customer area that the attack resides in.
      type: string
    - contextPath: Netcraft.Takedown.DateSubmitted
      description: The date and time of reporting.
      type: string
    - contextPath: Netcraft.Takedown.LastUpdated
      description: The date and time of the last action taken on the takedown.
      type: string
    - contextPath: Netcraft.Takedown.EvidenceURL
      description: The URL of the evidence page on incident.netcraft.com.
      type: string
    - contextPath: Netcraft.Takedown.Reporter
      description: The person/account that submitted the takedown.
      type: string
    - contextPath: Netcraft.Takedown.IP
      description: The IPv4 address of the attack.
      type: Unknown
    - contextPath: Netcraft.Takedown.Domain
      description: "\tThe domain of the URL or email address being taken down. This\
        \ will be blank for attacks with no domain name."
      type: Unknown
    - contextPath: Netcraft.Takedown.Hostname
      description: The full hostname of the URL or email address being taken down.
        This will be blank for attacks with no hostname.
      type: Unknown
    - contextPath: Netcraft.Takedown.CountryCode
      description: ISO country code of the hosting country.
      type: Unknown
    - contextPath: Netcraft.Takedown.DomainAttack
      description: Whether or not the domain is believed to be fraudulent.
      type: Unknown
    - contextPath: Netcraft.Takedown.TargetedURL
      description: The URL which this attack is masquarading as, e.g. the URL of the
        legitimate login form that the attack targets.
      type: Unknown
    - contextPath: Netcraft.Takedown.Certificate
      description: TTPS certificate details for the hostname, or null if no certificate
        was found. The value returned is the output of PHP's openssl_x509_parse function.
      type: Unknown
  - arguments:
    - default: false
      description: The takedown you'd like to see notes from.
      isArray: false
      name: takedown_id
      required: false
      secret: false
    - default: false
      description: A takedown group you'd like to see notes from.
      isArray: false
      name: group_id
      required: false
      secret: false
    - default: false
      description: A date which you only want to see notes that were created after
        it
      isArray: false
      name: date_from
      required: false
      secret: false
    - default: false
      description: A date which you only want to see notes that were created before
        it
      isArray: false
      name: date_to
      required: false
      secret: false
    - default: false
      description: A specific user which you'd like to see notes from
      isArray: false
      name: author
      required: false
      secret: false
    deprecated: false
    description: Get notes for takedowns
    execution: false
    name: netcraft-get-takedown-notes
    outputs:
    - contextPath: Netcraft.Takedown.Note.TakedownID
      description: The ID of the takedown that the note belongs to.
      type: number
    - contextPath: Netcraft.Takedown.Note.NoteID
      description: The ID of the note.
      type: number
    - contextPath: Netcraft.Takedown.Note.GroupID
      description: If this note is attached to all takedowns in a group, group_id
        is the ID of that group. Otherwise, the value 0 means the note is sent only
        to one takedown.
      type: number
    - contextPath: Netcraft.Takedown.Note.Author
      description: The author of the note, "Netcraft" denotes a Netcraft authored
        note.
      type: string
    - contextPath: Netcraft.Takedown.Note.Note
      description: The text content of the note.
      type: string
    - contextPath: Netcraft.Takedown.Note.Time
      description: The date/time the note was created, in YYYY-MM-DD HH:MM:SS format
        (in UTC).
      type: string
  - arguments:
    - default: false
      description: A valid takedown id to add the note to.
      isArray: false
      name: takedown_id
      required: true
      secret: false
    - default: false
      description: The text to add to the takedown.
      isArray: false
      name: note
      required: true
      secret: false
    - auto: PREDEFINED
      default: false
      description: Whether or not to notify Netcraft, defaults to true.
      isArray: false
      name: notify
      predefined:
      - 'True'
      - 'False'
      required: false
      secret: false
    deprecated: false
    description: Add notes to an existing takedown.
    execution: false
    name: netcraft-add-notes-to-takedown
  - arguments:
    - default: false
      description: The id of a takedown to escalate.
      isArray: false
      name: takedown_id
      required: true
      secret: false
    deprecated: false
    description: Escalate a takedown.
    execution: false
    name: netcraft-escalate-takedown
  isfetch: false
  runonce: false
  script: "''' IMPORTS '''\nimport requests\nfrom requests.auth import HTTPBasicAuth\n\
    \n\n# Disable insecure warnings\nrequests.packages.urllib3.disable_warnings()\n\
    \n''' GLOBALS/PARAMS '''\n\nUSERNAME = demisto.params().get('username')\nPASSWORD\
    \ = demisto.params().get('password')\nLIMIT = demisto.params().get('limit')\n\n\
    USE_SSL = not demisto.params().get('unsecure', False)\n\n\n# Service base URL\n\
    BASE_URL = \"https://takedown.netcraft.com/\"\n\n\n# codes for maicious site report\n\
    MALICIOUS_REPORT_SUCCESS = \"TD_OK\"\nMALICIOUS_REPORT_ALREADY_EXISTS = \"TD_EXISTS\"\
    \nMALICIOUS_REPORT_URL_IS_WILDCARD = \"TD_WILDCARD\"\nMALICIOUS_REPORT_ACCESS_DENIED\
    \ = \"TD_DENIED\"\nMALICIOUS_REPORT_ERROR = \"TD_ERROR\"\n\n\n# suffix endpoints\n\
    REPORT_MALICIOUS_SUFFIX = \"authorise.php\"\nGET_TAKEDOWN_INFO_SUFFIX = \"apis/get-info.php\"\
    \nACCESS_TAKEDOWN_NOTES_SUFFIX = \"apis/note.php\"\nESCALATE_TAKEDOWN_SUFFIX =\
    \ \"apis/escalate.php\"\nTEST_MODULE_SUFFIX = \"authorise-test.php\"\n\n\n# Table\
    \ Headers\nTAKEDOWN_INFO_HEADER = [\"ID\", \"Status\", \"Attack Type\", \"Date\
    \ Submitted\", \"Last Updated\", \"Reporter\", \"Group ID\",\n               \
    \         \"Region\", \"Evidence URL\", \"Attack URL\", \"IP\", \"Domain\", \"\
    Hostname\", \"Country Code\",\n                        \"Domain Attack\", \"Targeted\
    \ URL\", \"Certificate\"]\nTAKEDOWN_NOTE_HEADERS = [\"Takedown ID\", \"Note ID\"\
    , \"Note\", \"Author\", \"Time\", \"Group ID\"]\n\n# Titles for human readables\n\
    TAKEDOWN_INFO_TITLE = \"Takedowns information found\"\nREPORT_MALICIOUS_SUCCESS_TITLE\
    \ = \"New takedown successfully created\"\n\n\n# Remove proxy if not set to true\
    \ in params\nif not demisto.params().get('proxy'):\n    del os.environ['HTTP_PROXY']\n\
    \    del os.environ['HTTPS_PROXY']\n    del os.environ['http_proxy']\n    del\
    \ os.environ['https_proxy']\n\n\n''' HELPER FUNCTIONS '''\n\n\n@logger\ndef http_request(method,\
    \ request_suffix, params=None, data=None, should_convert_to_json=True):\n    #\
    \ A wrapper for requests lib to send our requests and handle requests and responses\
    \ better\n    res = requests.request(\n        method,\n        BASE_URL + request_suffix,\n\
    \        verify=USE_SSL,\n        params=params,\n        data=data,\n       \
    \ auth=HTTPBasicAuth(USERNAME, PASSWORD)\n    )\n\n    if should_convert_to_json:\n\
    \        return res.json()\n    else:\n        return res.text.splitlines()\n\n\
    \n@logger\ndef filter_by_id(result_list_to_filter, filtering_id_field, desired_id):\n\
    \    \"\"\" Given a list of results, returns only the ones that are tied to a\
    \ given ID.\n\n    Args:\n         result_list_to_filter (list): list of dictionaries,\
    \ containing data about entries.\n         filtering_id_field: The name of the\
    \ field containing the IDs to filter.\n         desired_id: The ID to keep when\
    \ filtering.\n\n    Returns:\n        list: A copy of the input list, containing\
    \ only entries with the desired ID.\n    \"\"\"\n\n    new_results_list = [result\
    \ for result in result_list_to_filter if result[filtering_id_field] == desired_id]\n\
    \    return new_results_list\n\n\n@logger\ndef generate_report_malicious_site_human_readable(response_lines_array):\n\
    \    response_status_code = response_lines_array[0]\n    human_readable = \"\"\
    \n    if response_status_code == MALICIOUS_REPORT_ALREADY_EXISTS:\n        human_readable\
    \ = \"### Takedown not submitted.\\n \" \\\n                         \"A takedown\
    \ for this URL already exists.\\n\" \\\n                         \"ID number of\
    \ the existing takedown: {}.\".format(response_lines_array[1])\n    elif response_status_code\
    \ == MALICIOUS_REPORT_URL_IS_WILDCARD:\n        human_readable = \"### Takedown\
    \ not submitted\\n \" \\\n                         \"This URL is a wildcard sub-domain\
    \ variation of an existing takedown.\\n\"\n    elif response_status_code == MALICIOUS_REPORT_ACCESS_DENIED:\n\
    \        human_readable = \"### Takedown not submitted\\n Access is denied.\"\n\
    \    elif response_status_code == MALICIOUS_REPORT_ERROR:\n        human_readable\
    \ = \"### Takedown not submitted\\n \" \\\n                         \"An error\
    \ has occurred while submitting your takedown.\\n\" \\\n                     \
    \    \"Error is: {}\".format(\" \".join(response_lines_array))\n    return human_readable\n\
    \n\n@logger\ndef return_dict_without_none_values(dict_with_none_values):\n   \
    \ \"\"\" Removes all keys from given dict which have None as a value.\n\n    Args:\n\
    \        dict_with_none_values (dict): dict which may include keys with None as\
    \ their value.\n\n    Returns:\n        dict: A new copy of the input dictionary,\
    \ from which all keys with None as a value were removed.\n    \"\"\"\n    new_dict\
    \ = {key: dict_with_none_values[key] for key in dict_with_none_values if\n   \
    \             dict_with_none_values[key] is not None}\n    return new_dict\n\n\
    \n@logger\ndef generate_takedown_info_context(takedown_info):\n    takedown_info_context\
    \ = {\n        \"ID\": takedown_info.get(\"id\"),\n        \"GroupID\": takedown_info.get(\"\
    group_id\"),\n        \"Status\": takedown_info.get(\"status\"),\n        \"AttackType\"\
    : takedown_info.get(\"attack_type\"),\n        \"AttackURL\": takedown_info.get(\"\
    attack_url\"),\n        \"Region\": takedown_info.get(\"region\"),\n        \"\
    DateSubmitted\": takedown_info.get(\"date_submitted\"),\n        \"LastUpdated\"\
    : takedown_info.get(\"last_updated\"),\n        \"EvidenceURL\": takedown_info.get(\"\
    evidence_url\"),\n        \"Reporter\": takedown_info.get(\"reporter\"),\n   \
    \     \"IP\": takedown_info.get(\"ip\"),\n        \"Domain\": takedown_info.get(\"\
    domain\"),\n        \"Hostname\": takedown_info.get(\"hostname\"),\n        \"\
    CountryCode\": takedown_info.get(\"country_code\"),\n        \"DomainAttack\"\
    : takedown_info.get(\"domain_attack\"),\n        \"TargetedURL\": takedown_info.get(\"\
    targeted_url\"),\n        \"Certificate\": takedown_info.get(\"certificate\")\n\
    \    }\n\n    # takedown_info_context = return_dict_without_none_values(takedown_info_context)\n\
    \    # return takedown_info_context\n    return createContext(takedown_info_context,\
    \ removeNull=True)\n\n\n@logger\ndef gen_takedown_info_human_readable(list_of_takedowns_contexts,\
    \ title=TAKEDOWN_INFO_TITLE):\n    contexts_in_human_readable_format = []\n  \
    \  for takedown_info_context in list_of_takedowns_contexts:\n        human_readable_dict\
    \ = {\n            \"ID\": takedown_info_context.get(\"ID\"),\n            \"\
    Status\": takedown_info_context.get(\"Status\"),\n            \"Attack Type\"\
    : takedown_info_context.get(\"AttackType\"),\n            \"Date Submitted\":\
    \ takedown_info_context.get(\"DateSubmitted\"),\n            \"Last Updated\"\
    : takedown_info_context.get(\"LastUpdated\"),\n            \"Reporter\": takedown_info_context.get(\"\
    Reporter\"),\n            \"Group ID\": takedown_info_context.get(\"GroupID\"\
    ),\n            \"Region\": takedown_info_context.get(\"Region\"),\n         \
    \   \"Evidence URL\": takedown_info_context.get(\"EvidenceURL\"),\n          \
    \  \"Attack URL\": takedown_info_context.get(\"AttackURL\"),\n            \"IP\"\
    : takedown_info_context.get(\"IP\"),\n            \"Domain\": takedown_info_context.get(\"\
    Domain\"),\n            \"Hostname\": takedown_info_context.get(\"Hostname\"),\n\
    \            \"Country Code\": takedown_info_context.get(\"CountryCode\"),\n \
    \           \"Domain Attack\": takedown_info_context.get(\"DomainAttack\"),\n\
    \            \"Targeted URL\": takedown_info_context.get(\"TargetedURL\"),\n \
    \           \"Certificate\": takedown_info_context.get(\"Certificate\")\n    \
    \    }\n        human_readable_dict = return_dict_without_none_values(human_readable_dict)\n\
    \        contexts_in_human_readable_format.append(human_readable_dict)\n\n   \
    \ human_readable = tableToMarkdown(title, contexts_in_human_readable_format,\n\
    \                                     headers=TAKEDOWN_INFO_HEADER)\n    return\
    \ human_readable\n\n\n@logger\ndef generate_list_of_takedowns_context(list_of_takedowns_infos):\n\
    \    takedowns_contexts_list = []\n    for takedown_info in list_of_takedowns_infos:\n\
    \        takedown_context = generate_takedown_info_context(takedown_info)\n  \
    \      takedowns_contexts_list.append(takedown_context)\n    return takedowns_contexts_list\n\
    \n\n@logger\ndef generate_takedown_note_context(takedown_note_json):\n    takedown_note_context\
    \ = {\n        \"TakedownID\": takedown_note_json.get(\"takedown_id\"),\n    \
    \    \"NoteID\": takedown_note_json.get(\"note_id\"),\n        \"GroupID\": takedown_note_json.get(\"\
    group_id\"),\n        \"Author\": takedown_note_json.get(\"author\"),\n      \
    \  \"Note\": takedown_note_json.get(\"note\"),\n        \"Time\": takedown_note_json.get(\"\
    time\")\n    }\n    takedown_note_context = return_dict_without_none_values(takedown_note_context)\n\
    \    return takedown_note_context\n\n\n@logger\ndef generate_list_of_takedown_notes_contexts(list_of_takedowns_notes):\n\
    \    takedown_notes_contexts_list = []\n    for takedown_note in list_of_takedowns_notes:\n\
    \        takedown_note_context = generate_takedown_note_context(takedown_note)\n\
    \        takedown_notes_contexts_list.append(takedown_note_context)\n    return\
    \ takedown_notes_contexts_list\n\n\n@logger\ndef gen_takedown_notes_human_readable(entry_context):\n\
    \    contexts_in_human_readable_format = []\n    for takedown_note_context in\
    \ entry_context:\n        human_readable_dict = {\n            \"Takedown ID\"\
    : takedown_note_context.get(\"TakedownID\"),\n            \"Note ID\": takedown_note_context.get(\"\
    NoteID\"),\n            \"Group ID\": takedown_note_context.get(\"GroupID\"),\n\
    \            \"Author\": takedown_note_context.get(\"Author\"),\n            \"\
    Note\": takedown_note_context.get(\"Note\"),\n            \"Time\": takedown_note_context.get(\"\
    Time\")\n        }\n        human_readable_dict = return_dict_without_none_values(human_readable_dict)\n\
    \        contexts_in_human_readable_format.append(human_readable_dict)\n\n   \
    \ human_readable = tableToMarkdown(TAKEDOWN_INFO_TITLE, contexts_in_human_readable_format,\n\
    \                                     headers=TAKEDOWN_NOTE_HEADERS)\n    return\
    \ human_readable\n\n\n@logger\ndef generate_add_note_human_readable(response):\n\
    \    # if the request was successful, the response includes the id of the created\
    \ note\n    if \"note_id\" in response:\n        human_readable = \"### Note added\
    \ succesfully\\n\" \\\n                         \"ID of the note created: {0}\"\
    .format(response[\"note_id\"])\n    else:\n        human_readable = \"### Failed\
    \ to add note\\n\" \\\n                         \"An error occured while trying\
    \ to add the note.\\n\" \\\n                         \"The error code is: {0}.\\\
    n\" \\\n                         \"The error message is: {1}.\".format(response[\"\
    error_code\"], response[\"error_code\"])\n    return human_readable\n\n\n@logger\n\
    def string_to_bool(string_representing_bool):\n    return string_representing_bool.lower()\
    \ == \"true\"\n\n\n@logger\ndef generate_escalate_takedown_human_readable(response):\n\
    \    if \"status\" in response:\n        human_readable = \"### Takedown escalated\
    \ successfully\"\n    else:\n        human_readable = \"### Takedown escalation\
    \ failed\\n\" \\\n                         \"An error occured on the takedown\
    \ escalation attempt.\\n\" \\\n                         \"Error code is: {0}\\\
    n\" \\\n                         \"Error message from Netcraft is: {1}\".format(response[\"\
    error_code\"], response[\"error_message\"])\n    return human_readable\n\n\ndef\
    \ add_or_update_note_context_in_takedown(note_context, cur_notes_in_takedown):\n\
    \    if isinstance(cur_notes_in_takedown, dict):\n        return [note_context]\n\
    \    else:\n        note_already_in_context = False\n        for i in range(len(cur_notes_in_takedown)):\n\
    \            cur_note_context = cur_notes_in_takedown[i]\n            if cur_note_context[\"\
    NoteID\"] == note_context[\"NoteID\"]:\n                note_already_in_context\
    \ = True\n                cur_notes_in_takedown[i] = note_context\n        if\
    \ not note_already_in_context:\n            cur_notes_in_takedown.append(note_context)\n\
    \        return cur_notes_in_takedown\n            \n\n\ndef add_note_to_suitable_takedown_in_context(note_context,\
    \ all_takedowns_entry_context):\n    note_takedown_index = -1\n    if isinstance(all_takedowns_entry_context,\
    \ dict):\n        new_takedown_entry_context = {\n            \"ID\": note_context[\"\
    TakedownID\"],\n            \"Note\": [note_context]\n        }\n        return_takedowns_entry_context\
    \ = [all_takedowns_entry_context, new_takedown_entry_context] \\\n           \
    \ if all_takedowns_entry_context else [new_takedown_entry_context]\n    else:\n\
    \        for i in range(len(all_takedowns_entry_context)):\n            cur_takedown_context\
    \ = all_takedowns_entry_context[i]\n            if cur_takedown_context[\"ID\"\
    ] == note_context[\"TakedownID\"]:\n                note_takedown_index = i\n\
    \        if note_takedown_index == -1:\n            new_takedown_entry_context\
    \ = {\n                \"ID\": note_context[\"TakedownID\"],\n               \
    \ \"Note\": [note_context]\n            }\n            return_takedowns_entry_context\
    \ = all_takedowns_entry_context\n            return_takedowns_entry_context.append(new_takedown_entry_context)\n\
    \        else:\n            takedown_context_to_change = all_takedowns_entry_context[note_takedown_index]\n\
    \            cur_notes_in_takedown = takedown_context_to_change[\"Note\"]\n  \
    \          takedown_context_to_change[\"Note\"] = add_or_update_note_context_in_takedown(note_context,\
    \ cur_notes_in_takedown)\n            return_takedowns_entry_context = all_takedowns_entry_context\n\
    \            return_takedowns_entry_context[note_takedown_index] = takedown_context_to_change\n\
    \    return return_takedowns_entry_context\n\n\n\ndef generate_netcraft_context_with_notes(list_of_notes_contexts):\n\
    \    all_takedowns_entry_context = demisto.context().get(\"Netcraft\", {}).get(\"\
    Takedown\", {})\n    for note_context in list_of_notes_contexts:\n        all_takedowns_entry_context\
    \ = add_note_to_suitable_takedown_in_context(note_context, all_takedowns_entry_context)\n\
    \    return all_takedowns_entry_context\n\n\n''' COMMANDS + REQUESTS FUNCTIONS\
    \ '''\n\n\n@logger\ndef escalate_takedown(takedown_id):\n    data_for_request\
    \ = {\n        \"takedown_id\": takedown_id\n    }\n    request_result = http_request(\"\
    POST\", ESCALATE_TAKEDOWN_SUFFIX, data=data_for_request)\n    return request_result\n\
    \n\ndef escalate_takedown_command():\n    args = demisto.args()\n    response\
    \ = escalate_takedown(args[\"takedown_id\"])\n    human_readable = generate_escalate_takedown_human_readable(response)\n\
    \    return_outputs(\n        readable_output=human_readable,\n        outputs={},\n\
    \        raw_response=response\n    )\n\n\n@logger\ndef add_notes_to_takedown(takedown_id,\
    \ note, notify):\n    data_for_request = {\n        \"takedown_id\": takedown_id,\n\
    \        \"note\": note,\n        \"notify\": notify\n    }\n\n    data_for_request\
    \ = return_dict_without_none_values(data_for_request)\n\n    request_result =\
    \ http_request(\"POST\", ACCESS_TAKEDOWN_NOTES_SUFFIX, data=data_for_request)\n\
    \    return request_result\n\n\ndef add_notes_to_takedown_command():\n    args\
    \ = demisto.args()\n    note = args.get(\"note\")\n    notify = string_to_bool(args.get(\"\
    notify\")) if args.get(\"notify\") else None\n    takedown_id = int(args[\"takedown_id\"\
    ])\n    response = add_notes_to_takedown(takedown_id, note, notify)\n    human_readable\
    \ = generate_add_note_human_readable(response)\n    return_outputs(\n        readable_output=human_readable,\n\
    \        outputs=response\n    )\n\n\ndef get_takedown_notes(takedown_id, group_id,\
    \ date_from, date_to, author):\n    data_for_request = {\n        \"takedown_id\"\
    : takedown_id,\n        \"group_id\": group_id,\n        \"date_to\": date_to,\n\
    \        \"date_from\": date_from,\n        \"author\": author\n    }\n\n    data_for_request\
    \ = return_dict_without_none_values(data_for_request)\n\n    request_result =\
    \ http_request(\"GET\", ACCESS_TAKEDOWN_NOTES_SUFFIX, data=data_for_request)\n\
    \    return request_result\n\n\ndef get_takedown_notes_command():\n    args =\
    \ demisto.args()\n    takedown_id = int(args.get(\"takedown_id\")) if args.get(\"\
    takedown_id\") else None\n    group_id = int(args.get(\"group_id\")) if args.get(\"\
    group_id\") else None\n    date_from = args.get(\"date_from\")\n    date_to =\
    \ args.get(\"date_to\")\n    author = args.get(\"author\")\n    list_of_takedowns_notes\
    \ = get_takedown_notes(takedown_id, group_id, date_from, date_to, author)\n  \
    \  if len(list_of_takedowns_notes) > LIMIT:\n        list_of_takedowns_notes =\
    \ list_of_takedowns_notes[:LIMIT]\n    if takedown_id:\n        list_of_takedowns_notes\
    \ = filter_by_id(list_of_takedowns_notes, \"takedown_id\", int(takedown_id))\n\
    \    list_of_notes_contexts = generate_list_of_takedown_notes_contexts(list_of_takedowns_notes)\n\
    \    entry_context = {\n        \"Netcraft.Takedown(val.ID == obj.ID)\": generate_netcraft_context_with_notes(list_of_notes_contexts)\n\
    \    }\n    human_readable = gen_takedown_notes_human_readable(list_of_notes_contexts)\n\
    \    return_outputs(\n        readable_output=human_readable,\n        outputs=entry_context,\n\
    \        raw_response=list_of_takedowns_notes\n    )\n\n\n@logger\ndef get_takedown_info(takedown_id,\
    \ ip, url, updated_since, date_from, region):\n    data_for_request = {\n    \
    \    \"id\": takedown_id,\n        \"ip\": ip,\n        \"url\": url,\n      \
    \  \"updated_since\": updated_since,\n        \"date_from\": date_from,\n    \
    \    \"region\": region,\n    }\n\n    data_for_request = return_dict_without_none_values(data_for_request)\n\
    \n    request_result = http_request(\"GET\", GET_TAKEDOWN_INFO_SUFFIX, data=data_for_request)\n\
    \    return request_result\n\n\ndef get_takedown_info_command():\n    args = demisto.args()\n\
    \    takedown_id = int(args.get(\"id\")) if args.get(\"id\") else None\n    ip\
    \ = args.get(\"ip\")\n    url = args.get(\"url\")\n    updated_since = args.get(\"\
    updated_since\")\n    date_from = args.get(\"date_from\")\n    region = args.get(\"\
    region\")\n    list_of_takedowns_infos = get_takedown_info(takedown_id, ip, url,\
    \ updated_since, date_from, region)\n    if len(list_of_takedowns_infos) > LIMIT:\n\
    \        list_of_takedowns_infos = list_of_takedowns_infos[:LIMIT]\n    if takedown_id:\n\
    \        list_of_takedowns_infos = filter_by_id(list_of_takedowns_infos, \"id\"\
    , str(takedown_id))\n    list_of_takedowns_contexts = generate_list_of_takedowns_context(list_of_takedowns_infos)\n\
    \    human_readable = gen_takedown_info_human_readable(list_of_takedowns_contexts)\n\
    \    entry_context = {\n        'Netcraft.Takedown(val.ID == obj.ID)': list_of_takedowns_contexts\n\
    \    }\n    return_outputs(\n        readable_output=human_readable,\n       \
    \ raw_response=list_of_takedowns_infos,\n        outputs=entry_context,\n    )\n\
    \n\n@logger\ndef report_malicious_site(malicious_site_url, comment, is_test_request=False):\n\
    \    data_for_request = {\n        \"attack\": malicious_site_url,\n        \"\
    comment\": comment\n    }\n    if is_test_request:\n        request_url_suffix\
    \ = TEST_MODULE_SUFFIX\n    else:\n        request_url_suffix = REPORT_MALICIOUS_SUFFIX\n\
    \    request_result = http_request(\"POST\", request_url_suffix, data=data_for_request,\
    \ should_convert_to_json=False)\n    return request_result\n\n\ndef report_malicious_site_command():\n\
    \    args = demisto.args()\n    entry_context = {}\n    response_lines_array =\
    \ report_malicious_site(args[\"malicious_site_url\"], args[\"comment\"])\n   \
    \ result_answer = response_lines_array[0]\n    if result_answer == MALICIOUS_REPORT_SUCCESS:\n\
    \        new_takedown_id = response_lines_array[1]\n        # Until the API bug\
    \ is fixed, this list will include info of all takedowns and not just the new\
    \ one\n        new_takedown_infos = get_takedown_info(new_takedown_id)\n     \
    \   if len(new_takedown_infos) > LIMIT:\n            new_takedown_infos = new_takedown_infos[:LIMIT]\n\
    \        new_takedown_infos = filter_by_id(new_takedown_infos, \"id\", new_takedown_id)\n\
    \        list_of_new_takedown_contexts = generate_list_of_takedowns_context(new_takedown_infos)\n\
    \        human_readable = gen_takedown_info_human_readable(list_of_new_takedown_contexts,\
    \ REPORT_MALICIOUS_SUCCESS_TITLE)\n        entry_context = {\n            'Netcraft.Takedown(val.ID\
    \ == obj.ID)': list_of_new_takedown_contexts\n        }\n    else:\n        human_readable\
    \ = generate_report_malicious_site_human_readable(response_lines_array)\n\n  \
    \  return_outputs(\n        readable_output=human_readable,\n        outputs=entry_context,\n\
    \        raw_response=entry_context\n    )\n\n\ndef test_module():\n    \"\"\"\
    \n    Performs basic get request to get item samples\n    \"\"\"\n    try:\n \
    \       test_result = report_malicious_site(\"https://www.test.com\", \"test\"\
    , True)\n        if test_result[0] != MALICIOUS_REPORT_SUCCESS:\n            raise\
    \ Exception(\"Test request failed.\")\n    except Exception as ex:\n        raise\
    \ Exception(str(ex))\n    demisto.results(\"ok\")\n\n\n''' COMMANDS MANAGER /\
    \ SWITCH PANEL '''\n\nLOG('Command being called is %s' % (demisto.command()))\n\
    \ntry:\n    if demisto.command() == 'test-module':\n        test_module()\n  \
    \  elif demisto.command() == 'netcraft-report-malicious-site':\n        report_malicious_site_command()\n\
    \    elif demisto.command() == 'netcraft-get-takedown-info':\n        get_takedown_info_command()\n\
    \    elif demisto.command() == 'netcraft-get-takedown-notes':\n        get_takedown_notes_command()\n\
    \    elif demisto.command() == 'netcraft-add-notes-to-takedown':\n        add_notes_to_takedown_command()\n\
    \    elif demisto.command() == 'netcraft-escalate-takedown':\n        escalate_takedown_command()\n\
    \n\n# Log exceptions\nexcept Exception as e:\n    LOG(str(e))\n    LOG.print_log()\n\
    \    raise"
  type: python
image: data:image/png;base64,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
releaseNotes: New Netcraft beta integration
